"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[712],{3712:(e,l,t)=>{t.r(l),t.d(l,{default:()=>W});var o=t(3673),n=t(2323),a=t(1959),s=t(8880),i=t(8339),r=t(2993),u=t(925),c=t(9236),d=function(e,l,t,o){function n(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,a){function s(e){try{r(o.next(e))}catch(l){a(l)}}function i(e){try{r(o["throw"](e))}catch(l){a(l)}}function r(e){e.done?t(e.value):n(e.value).then(s,i)}r((o=o.apply(e,l||[])).next())}))};const p={class:"container"},v={class:"treasury-title"},m={class:"q-pb-md row q-col-gutter-sm"},b={class:"col-xs-12 col-sm-4"},y={class:"col-xs-12 col-sm-5"},w={class:"col-xs-12 col-sm-3"},f={class:"col-xs-12 q-mb-lg"},h={id:"report-content",class:"q-table-simple q-table__container q-table--horizontal-separator column no-wrap q-table--dense q-table--no-wrap table-responsive"},g={id:"pdf-title",class:"treasury-title q-mt-lg",style:{display:"none"}},k={key:0,class:"q-table treasury-table-data"},_=(0,o._)("th",null,"Nombre completo",-1),U={key:0,class:"treasury-observation"},q={class:"flow-row-table"},D={class:"text-hidden"},z={key:0,class:"flow-row-content text-right"},C={class:"treasury-list-concepts"},V={class:"treasury-observation-report"},x={key:0,class:"treasury-list-concepts"},H={class:"treasury-observation-report"},S=["onClick"],O={key:1,class:"treasury-observation text-right"},E={key:1,class:"alert alert-info"},$=(0,o.aZ)({__name:"Offerings",setup(e){var l,t,$;const Y=(0,c.o)(),M=(0,i.tv)(),T=(0,a.iH)({}),Z=(0,a.iH)(""),j=(0,a.iH)(!1),I=(0,a.iH)((new Date).getFullYear()),L=Number(null===($=null===(t=null===(l=Y.state.user)||void 0===l?void 0:l.user)||void 0===t?void 0:t.company)||void 0===$?void 0:$.id),Q=(0,u.V4)(),R=()=>M.push("/treasury/reports"),W={member:"Miembro",sympathizer:"Miembro Esc. sabática",visit:"Visita"},B=()=>d(this,void 0,void 0,(function*(){const e=yield r.http.get(`entries/report/offerings-by-church?year=${I.value}&id_company=${L}&id_department=0`),l=e&&"object"===typeof e&&"data"in e?e.data:e,t=null!==l&&void 0!==l?l:{};for(const o in t)t[o]&&"object"===typeof t[o]&&(t[o].active=!1);T.value=t}));(0,o.YP)(I,B);const K=(0,o.Fl)((()=>{var e;const l=null!==(e=T.value)&&void 0!==e?e:{};return Object.keys(l).length>0})),N=(0,o.Fl)((()=>{var e,l,t;const o=null!==(e=T.value)&&void 0!==e?e:{};if(""!==Z.value){const e={};for(const t in o)o[t].label.toLowerCase().includes(Z.value.toLowerCase())&&(!j.value||j.value&&"MEMBER"===(null===(l=o[t].type)||void 0===l?void 0:l.toUpperCase()))&&(e[t]=o[t]);return e}if(j.value){const e={};for(const l in o)"MEMBER"===(null===(t=o[l].type)||void 0===t?void 0:t.toUpperCase())&&(e[l]=o[l]);return e}return o})),P=e=>{const l=[];for(const t in e)e[t].group&&["TITHES","SCOOP"].includes(e[t].group)&&l.push(e[t]);return l},F=()=>d(this,void 0,void 0,(function*(){var e;const l=yield r.http.get(`entries/report/offerings-by-church/pdf?year=${I.value}&id_company=${L}&id_department=0`),t="string"===typeof l?l:null===l||void 0===l?void 0:l.data;if(!t)return;const o=Uint8Array.from(atob(t),(e=>e.charCodeAt(0))),n=new Blob([o],{type:"application/pdf"}),a=URL.createObjectURL(n),s=`informe-ofrendas-${(null===(e=Y.state.user.user.company)||void 0===e?void 0:e.name)||"iglesia"}-${I.value}-${Date.now()}.pdf`,i=document.createElement("a");i.href=a,i.download=s,i.click(),URL.revokeObjectURL(a)}));return(0,o.bv)(B),(e,l)=>{var t,i;const r=(0,o.up)("q-btn"),c=(0,o.up)("q-select"),d=(0,o.up)("q-icon"),$=(0,o.up)("q-input"),M=(0,o.up)("q-checkbox");return(0,o.wg)(),(0,o.iD)("div",p,[(0,o._)("h2",v,[(0,o.Wm)(r,{icon:"arrow_back",round:"",flat:"",onClick:R}),(0,o.Uk)(" Informe de ofrendas y diezmos - "+(0,n.zw)(null===(t=(0,a.SU)(Y).state.user.user.company)||void 0===t?void 0:t.name),1)]),(0,o._)("div",m,[(0,o._)("div",b,[(0,o.Wm)(c,{filled:"",modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=e=>I.value=e),options:(0,a.SU)(Q),label:"Gestión"},null,8,["modelValue","options"])]),(0,o._)("div",y,[(0,o.Wm)($,{filled:"",label:"Buscar por Nombre o apellido",modelValue:Z.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Z.value=e),"input-debounce":"1000",placeholder:"Escribe el nombre o apellido de la persona a buscar"},(0,o.Nv)({_:2},[Z.value.length>0?{name:"append",fn:(0,o.w5)((()=>[(0,o.Wm)(d,{name:"close",onClick:l[1]||(l[1]=e=>Z.value=""),class:"cursor-pointer"})])),key:"0"}:void 0]),1032,["modelValue"])]),(0,o._)("div",w,[(0,o.Wm)(M,{modelValue:j.value,"onUpdate:modelValue":l[3]||(l[3]=e=>j.value=e),label:"Ver solo miembros"},null,8,["modelValue"])])]),(0,o._)("div",f,[(0,o.Wm)(r,{icon:"print","no-caps":"",label:"Imprimir",onClick:F})]),(0,o._)("div",h,[(0,o._)("h2",g," Ofrendas y diezmos "+(0,n.zw)(null===(i=(0,a.SU)(Y).state.user.user.company)||void 0===i?void 0:i.name)+" - Gestión "+(0,n.zw)(I.value),1),(0,a.SU)(K)?((0,o.wg)(),(0,o.iD)("table",k,[(0,o._)("thead",null,[(0,o._)("tr",null,[_,((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(e=>(0,o._)("th",{key:e},(0,n.zw)((0,a.SU)(u.e7)[e-1]),1))),64))])]),(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,a.SU)(N),(l=>{var t;return(0,o.wg)(),(0,o.iD)("tr",{key:l.value},[(0,o._)("td",null,[(0,o.Uk)((0,n.zw)(l.label)+" ",1),l.type?((0,o.wg)(),(0,o.iD)("span",U,(0,n.zw)(W[l.type])+" "+(0,n.zw)((null===(t=e.$store.state.user.user.company)||void 0===t?void 0:t.name)!==l.church?`- ${l.church}`:""),1)):(0,o.kq)("",!0)]),((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(e=>(0,o._)("td",{key:e},[(0,o._)("div",q,[(0,o._)("span",D,(0,n.zw)((0,a.SU)(u.e7)[e-1])+":",1),l.months&&l.months[e]?((0,o.wg)(),(0,o.iD)("div",z,[(0,o._)("ul",C,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(P(l.months[e]),(e=>((0,o.wg)(),(0,o.iD)("li",{key:e.id},[(0,o._)("span",V,(0,n.zw)(e.label)+": ",1),(0,o.Uk)(),(0,o._)("strong",null,(0,n.zw)(e.value),1)])))),128))]),!0===l.active?((0,o.wg)(),(0,o.iD)("ul",x,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.months[e],(e=>((0,o.wg)(),(0,o.iD)("li",{key:e.id},["TITHES"!==e.group&&"SCOOP"!==e.group?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o._)("span",H,(0,n.zw)(e.label)+": ",1),(0,o.Uk)(),(0,o._)("strong",null,(0,n.zw)(e.value),1)],64)):(0,o.kq)("",!0)])))),128))])):(0,o.kq)("",!0),Object.keys(l.months[e]).length>P(l.months[e]).length?((0,o.wg)(),(0,o.iD)("a",{key:1,class:"flow-row-link",href:"",onClick:(0,s.iM)((e=>l.active=!l.active),["prevent"])},(0,n.zw)(!0===l.active?"Ver menos":"Ver más"),9,S)):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.iD)("span",O,"-"))])]))),64))])})),128))])])):((0,o.wg)(),(0,o.iD)("div",E,"No existe información para la gestión "+(0,n.zw)(I.value),1))])])}}});var Y=t(2165),M=t(2448),T=t(4689),Z=t(4554),j=t(5735),I=t(6429),L=t(7518),Q=t.n(L);const R=$,W=R;Q()($,"components",{QBtn:Y.Z,QSelect:M.Z,QInput:T.Z,QIcon:Z.Z,QCheckbox:j.Z,QTable:I.Z})}}]);