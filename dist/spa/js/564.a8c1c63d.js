"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[564],{564:(e,l,t)=>{t.r(l),t.d(l,{default:()=>ye});var a=t(3673),o=t(2323),u=t(1959),n=t(8339),i=t(2993),s=t(185),d=t(925),c=t(9236),r=t(8468),p=function(e,l,t,a){function o(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,u){function n(e){try{s(a.next(e))}catch(l){u(l)}}function i(e){try{s(a["throw"](e))}catch(l){u(l)}}function s(e){e.done?t(e.value):o(e.value).then(n,i)}s((a=a.apply(e,l||[])).next())}))};const m={key:0,class:"container"},v={class:"treasury-title"},y={key:0,class:"text-warning"},_={class:"subtitle"},f={class:"row"},w={key:0,class:"col-xs-12 col-sm-5"},h={class:"col-xs-12"},b={class:"col-xs-12"},g={class:"col-xs-12"},x={class:"col-xs-12"},k={class:"row items-center justify-end"},D={class:"col-xs-12"},q=(0,a._)("h3",{class:"text-secondary treasury-subtitle q-px-md"},"Datos de la factura, recibo...",-1),C={class:"col-xs-12"},V={class:"col-xs-12"},L={class:"col-xs-12"},O={class:"col-xs-12"},U={class:"q-table-simple q-table__container q-table--horizontal-separator column no-wrap q-table--dense q-table--no-wrap"},W={key:0,class:"text-left"},A=(0,a._)("th",{class:"text-left"},[(0,a._)("strong",null,"Descripción")],-1),T={key:1,class:"text-left"},z=(0,a._)("strong",null,"Datos de facturación",-1),E=[z],S=(0,a._)("th",{class:"text-right"},[(0,a._)("strong",null,"Valor")],-1),Z={key:0,class:"width-80"},$={class:"text-left"},Q={class:"treasury-departament"},I={key:1,class:"text-left"},R={class:"treasury-list-concepts"},H={key:0},F=(0,a._)("strong",null,"Tipo de documento:",-1),P={key:1},B=(0,a._)("strong",null,"Número de documento:",-1),G={key:2},N=(0,a._)("strong",null,"Proveedor:",-1),j={class:"text-right total"},Y=(0,a._)("th",{class:"text-left",colspan:"2"},[(0,a._)("strong",null,"Total")],-1),K={class:"text-right"},M={class:"text-right q-pt-xs q-gutter-xs"},J=(0,a.aZ)({__name:"Expense",setup(e){var l,t;const z=(0,c.o)(),J=[{value:"FACTURA",label:"FACTURA"},{value:"RECIBO",label:"RECIBO"},{value:"NOTA DE VENTA",label:"NOTA DE VENTA"},{value:"OTRO",label:"OTRO"}],X=null===(t=null===(l=z.state.user)||void 0===l?void 0:l.user)||void 0===t?void 0:t.company.id,ee=(0,u.iH)([]),le=(0,u.iH)([]),te=(0,u.iH)([]),ae=(0,u.iH)(!0),oe=(0,u.iH)("LOCAL"),ue=(0,u.iH)({id:null,date:null,value:"",concept:"",documentType:"",document_number:"",supplier:"",expense:null,department:null,idDepartment:null}),ne=(0,u.iH)(),ie=(0,u.iH)(),se=(0,u.iH)([]),de=(0,n.yj)(),{expenseId:ce}=de.params,re=()=>p(this,void 0,void 0,(function*(){ne.value=yield i.http.get("expenses/"+ +ce)})),pe=()=>p(this,void 0,void 0,(function*(){const e=yield i.http.get(`departments?order=id&type=${oe.value}`);ee.value=e.rows.map((e=>{var l;return{value:e.id,type:"GLOBAL"===e.type?"Asociación":"Iglesia local",label:e.name,group:e.group,total:(null===(l=le.value.find((l=>l.department.id===e.id)))||void 0===l?void 0:l.total)||0}}))}));(0,a.YP)(oe,(()=>p(this,void 0,void 0,(function*(){yield pe()}))));const me=()=>p(this,void 0,void 0,(function*(){const e=yield i.http.get(`flows?id_company=${X}&type=GENERAL`);le.value=e.rows})),ve=(e,l)=>{l((()=>{if(""===e)te.value=ee.value;else{const l=e.toLowerCase();te.value=ee.value.filter((e=>e.label.toLowerCase().indexOf(l)>-1))}}))},ye=()=>p(this,void 0,void 0,(function*(){ue.value.id_expense=ne.value.id,ue.value.document_type=ue.value.documentType.value,ue.value.id_department=ue.value.idDepartment.value,ue.value.type=oe.value,ue.value.id?yield i.http.put(`expensesdetails/${ue.value.id}`,ue.value):yield i.http.post("expensesdetails",ue.value),yield he(),yield we()})),_e=e=>p(this,void 0,void 0,(function*(){ue.value=yield i.http.get(`expensesdetails/${e}`),ue.value.idDepartment={value:ue.value.department.id,label:ue.value.department.name},ue.value.documentType={value:ue.value.document_type,label:ue.value.document_type},oe.value=ue.value.type})),fe=e=>{(0,s.Confirm)("¿Desea eliminar el registro?",(()=>p(this,void 0,void 0,(function*(){yield i.http["delete"](`expensesdetails/${e}`),yield he()}))))},we=()=>p(this,void 0,void 0,(function*(){ae.value=!1,yield(0,a.Y3)((()=>{ue.value={id:null,date:null,value:"",concept:"",documentType:"",document_number:"",supplier:"",expense:null,department:null,idDepartment:null},ae.value=!0}))})),he=()=>p(this,void 0,void 0,(function*(){const e=yield i.http.get(`expensesdetails?id_expense=${ne.value.id}`);se.value=e.rows})),be=()=>p(this,void 0,void 0,(function*(){const e=yield i.http.get(`entries?year=${ne.value.year}&month=${ne.value.month}&id_company=${X}`);e.count&&(ie.value=e.rows[0])})),ge=(0,a.Fl)((()=>{let e=0;for(const l of se.value)e+=parseFloat(l.value);return e}));return(0,a.wF)((()=>p(this,void 0,void 0,(function*(){yield me(),yield pe(),yield re(),yield he(),yield be()})))),(e,l)=>{var t;const n=(0,a.up)("q-btn"),i=(0,a.up)("q-btn-group"),s=(0,a.up)("q-item-label"),c=(0,a.up)("q-item-section"),p=(0,a.up)("q-item"),z=(0,a.up)("q-select"),X=(0,a.up)("q-input"),ee=(0,a.up)("q-date"),le=(0,a.up)("q-popup-proxy"),de=(0,a.up)("q-icon"),ce=(0,a.up)("q-form"),re=(0,a.Q2)("close-popup");return ne.value?((0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("h2",v,[(0,a.Wm)(n,{icon:"arrow_back",round:"",flat:"",onClick:l[0]||(l[0]=l=>e.$router.push(`/treasury/entryexpense/${ie.value.id}/${e.$route.params.expenseId}`))}),(0,a.Uk)(" Gastos - "+(0,o.zw)((0,u.SU)(d.e7)[ne.value.month-1])+" ",1),"CLOSED"===ne.value.state?((0,a.wg)(),(0,a.iD)("span",y," CERRADO")):(0,a.kq)("",!0),(0,a._)("span",_,"Total: "+(0,o.zw)((0,u.SU)(ge))+" "+(0,o.zw)(null===(t=e.$store.state.user)||void 0===t?void 0:t.user.company.money),1)]),(0,a._)("div",f,["CLOSED"!==ne.value.state?((0,a.wg)(),(0,a.iD)("div",w,[ae.value?((0,a.wg)(),(0,a.j4)(ce,{key:0,onSubmit:ye,onReset:we,class:"q-gutter-md"},{default:(0,a.w5)((()=>[(0,a._)("div",h,[(0,a.Wm)(i,{spread:"",outline:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{outline:"LOCAL"!==oe.value,padding:"12px",color:"primary",label:"Iglesia local",onClick:l[1]||(l[1]=e=>oe.value="LOCAL"),"no-caps":""},null,8,["outline"]),(0,a.Wm)(n,{outline:"GLOBAL"!==oe.value,padding:"10px",color:"primary",label:"Asociación",onClick:l[2]||(l[2]=e=>oe.value="GLOBAL"),"no-caps":""},null,8,["outline"])])),_:1})]),(0,a._)("div",b,[(0,a.Wm)(z,{filled:"",label:"Departamento",modelValue:ue.value.idDepartment,"onUpdate:modelValue":l[3]||(l[3]=e=>ue.value.idDepartment=e),"use-input":"","use-chips":"","input-debounce":"0",options:te.value,onFilter:ve,"lazy-rules":"",rules:[e=>!!e||"Seleccione el departamento"]},{option:(0,a.w5)((e=>[(0,a.Wm)(p,(0,o.vs)((0,a.F4)(e.itemProps)),{default:(0,a.w5)((()=>[(0,a.Wm)(c,{class:"treasury-department-item"},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.opt.label),1)])),_:2},1024),(0,a.Wm)(s,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.opt.type),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","rules"])]),(0,a._)("div",g,[(0,a.Wm)(X,{filled:"",label:"Concepto",modelValue:ue.value.concept,"onUpdate:modelValue":l[4]||(l[4]=e=>ue.value.concept=e),rules:[e=>!!e||"Debe llenar el concepto"]},null,8,["modelValue","rules"])]),(0,a._)("div",x,[(0,a.Wm)(X,{label:"Fecha",filled:"",modelValue:ue.value.date,"onUpdate:modelValue":l[6]||(l[6]=e=>ue.value.date=e),mask:"date",rules:["date",e=>!!e||"Debe seleccionar una fecha"]},{append:(0,a.w5)((()=>[(0,a.Wm)(de,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(le,{ref:"qDateProxy",cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(ee,{modelValue:ue.value.date,"onUpdate:modelValue":l[5]||(l[5]=e=>ue.value.date=e),minimal:""},{default:(0,a.w5)((()=>[(0,a._)("div",k,[(0,a.wy)((0,a.Wm)(n,{label:"Cerrar",color:"primary",flat:""},null,512),[[re]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"])]),(0,a._)("div",D,[(0,a.Wm)(X,{filled:"",label:"Monto",modelValue:ue.value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>ue.value.value=e),rules:[(0,u.SU)(r.Z).required,(0,u.SU)(r.Z).decimal]},null,8,["modelValue","rules"])]),q,(0,a._)("div",C,[(0,a.Wm)(z,{filled:"",label:"Tipo de documento",modelValue:ue.value.documentType,"onUpdate:modelValue":l[8]||(l[8]=e=>ue.value.documentType=e),options:J},null,8,["modelValue"])]),(0,a._)("div",V,[(0,a.Wm)(X,{filled:"",label:"Número de documento",modelValue:ue.value.document_number,"onUpdate:modelValue":l[9]||(l[9]=e=>ue.value.document_number=e)},null,8,["modelValue"])]),(0,a._)("div",L,[(0,a.Wm)(X,{filled:"",label:"Proveedor o responsable",modelValue:ue.value.supplier,"onUpdate:modelValue":l[10]||(l[10]=e=>ue.value.supplier=e)},null,8,["modelValue"])]),(0,a._)("div",O,[ue.value.id?((0,a.wg)(),(0,a.j4)(n,{key:0,type:"reset",padding:"10px",label:"Cancelar","no-caps":"",icon:"cancel",class:"full-width q-mb-sm"})):(0,a.kq)("",!0),(0,a.Wm)(n,{type:"submit",padding:"10px",label:ue.value.id?"Actualizar":"Registrar",color:"primary","no-caps":"",icon:"check",class:"full-width"},null,8,["label"])])])),_:1})):(0,a.kq)("",!0)])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,o.C_)(["col-xs-12 tithe-column",{"col-sm-7":"CLOSED"!==ne.value.state,"col-sm-12":"CLOSED"===ne.value.state}])},[(0,a._)("div",U,[(0,a._)("table",{class:(0,o.C_)(["q-table",{"treasury-table-data":"CLOSED"===ne.value.state}])},[(0,a._)("thead",null,[(0,a._)("tr",null,["CLOSED"!==ne.value.state?((0,a.wg)(),(0,a.iD)("th",W)):(0,a.kq)("",!0),A,"CLOSED"===ne.value.state?((0,a.wg)(),(0,a.iD)("th",T,E)):(0,a.kq)("",!0),S])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(se.value,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},["CLOSED"!==ne.value.state?((0,a.wg)(),(0,a.iD)("td",Z,[(0,a.Wm)(n,{size:"sm",icon:"edit",round:"",flat:"",onClick:l=>_e(e.id)},null,8,["onClick"]),(0,a.Wm)(n,{size:"sm",icon:"delete",round:"",flat:"",onClick:l=>fe(e.id)},null,8,["onClick"])])):(0,a.kq)("",!0),(0,a._)("td",$,[(0,a.Uk)((0,o.zw)(e.concept)+" ",1),(0,a._)("strong",Q,[(0,a.Uk)((0,o.zw)(e.department.name)+" - ",1),(0,a._)("em",null,(0,o.zw)("GLOBAL"===e.type?"Asociación":"Iglesia local"),1)]),(0,a._)("em",null,"Registrado el "+(0,o.zw)((0,u.SU)(d.WU)(e.date)),1)]),"CLOSED"===ne.value.state?((0,a.wg)(),(0,a.iD)("td",I,[(0,a._)("ul",R,[e.document_type?((0,a.wg)(),(0,a.iD)("li",H,[F,(0,a.Uk)(" "+(0,o.zw)(e.document_type),1)])):(0,a.kq)("",!0),e.document_number?((0,a.wg)(),(0,a.iD)("li",P,[B,(0,a.Uk)(" "+(0,o.zw)(e.document_number),1)])):(0,a.kq)("",!0),e.supplier?((0,a.wg)(),(0,a.iD)("li",G,[N,(0,a.Uk)(" "+(0,o.zw)(e.supplier),1)])):(0,a.kq)("",!0)])])):(0,a.kq)("",!0),(0,a._)("td",j,(0,o.zw)(e.value),1)])))),128))]),(0,a._)("tfoot",null,[(0,a._)("tr",null,[Y,(0,a._)("th",K,[(0,a._)("strong",null,(0,o.zw)((0,u.SU)(ge)),1)])])])],2)]),(0,a._)("div",M,[ie.value?((0,a.wg)(),(0,a.j4)(n,{key:0,label:"Ver ingresos del mes","no-caps":"",icon:"attach_money",padding:"10px 20px",class:"btn-close-month",onClick:l[11]||(l[11]=l=>e.$router.push(`/treasury/week/${ie.value.id}`))})):(0,a.kq)("",!0)])],2)])])):(0,a.kq)("",!0)}}});var X=t(2165),ee=t(8689),le=t(6375),te=t(2448),ae=t(3414),oe=t(2035),ue=t(2350),ne=t(4689),ie=t(4554),se=t(3944),de=t(5836),ce=t(6429),re=t(677),pe=t(7518),me=t.n(pe);const ve=J,ye=ve;me()(J,"components",{QBtn:X.Z,QForm:ee.Z,QBtnGroup:le.Z,QSelect:te.Z,QItem:ae.Z,QItemSection:oe.Z,QItemLabel:ue.Z,QInput:ne.Z,QIcon:ie.Z,QPopupProxy:se.Z,QDate:de.Z,QTable:ce.Z}),me()(J,"directives",{ClosePopup:re.Z})}}]);