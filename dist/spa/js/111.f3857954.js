"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[111],{8879:(e,a,l)=>{l.r(a),l.d(a,{default:()=>B});var t=l(3673),o=l(1959),n=l(2323),i=l(2993),u=l(4626),r=l(4781),s=l(8339),c=l(9236),d=l(925),m=l(5198),p=l(8468),v=function(e,a,l,t){function o(e){return e instanceof l?e:new l((function(a){a(e)}))}return new(l||(l=Promise))((function(l,n){function i(e){try{r(t.next(e))}catch(a){n(a)}}function u(e){try{r(t["throw"](e))}catch(a){n(a)}}function r(e){e.done?l(e.value):o(e.value).then(i,u)}r((t=t.apply(e,a||[])).next())}))};const w={class:"container"},b={class:"treasury-title"},f={key:1,class:"alert alert-info"},y={class:"row"},h={class:"col-sm-7 q-gutter-sm q-pb-sm"},g=(0,t._)("h6",null,"Tipo de transacción",-1),_={class:"col-sm-5 q-pt-lg"},q={class:"row items-center justify-end"},W=(0,t.aZ)({__name:"Transactions",setup(e){var a,l;const W=(0,s.yj)(),k=(0,s.tv)(),{entryId:Z}=W.params,U=(0,c.o)(),C=[{label:"Fecha movimiento",align:"left",name:"transaction.date",sortable:!0},{label:"Descripción",align:"left",name:"transaction.description",sortable:!0},{label:"Monto",align:"right",name:"transaction.amount",sortable:!0},{label:"Saldo",align:"right",name:"transaction.balance",sortable:!0},{label:"Estado",align:"right",name:"transaction.state",sortable:!0}],V=(0,o.iH)([]),E={MEMBER:{color:"positive",textColor:"white",label:"MIEMBRO"},PENDING:{color:"warning",textColor:"white",label:"PENDIENTE"},FINISHED:{color:"positive",textColor:"white",label:"PROCESADO"}},Q=null===(l=null===(a=U.state.user)||void 0===a?void 0:a.user)||void 0===l?void 0:l.company.id,x=(0,o.iH)(),T=(0,o.iH)(),$=(0,o.iH)(),S=(0,o.iH)(!1),D=(0,o.iH)(0),I=`transactions?id_company=${Q}`,P=(0,o.iH)(I),N=(e,a)=>v(this,void 0,void 0,(function*(){a?(x.value=yield i.http.get(`${I}/${a}`),x.value.date=(0,d.WU)(x.value.date)):x.value={interest:!1,type:"ENTRY"},e()})),M=e=>v(this,void 0,void 0,(function*(){var a;"EXPENSE"===x.value.type&&(x.value.interest=!1),x.value.id_account=$,x.value.date=(0,d.Fv)(x.value.date),(null===(a=x.value)||void 0===a?void 0:a.id)?(yield i.http.put(`${I}/${x.value.id}`,x.value),u.message.success("¡Transacción actualizada!")):(x.value.id_entry=Z,yield i.http.post(I,x.value),u.message.success("¡Transacción creada exitósamente!")),e.update(),e.close(),yield A($.value)})),z=()=>v(this,void 0,void 0,(function*(){const e=yield i.http.get(`accounts?id_company=${Q}&order=id`);T.value=e.rows,1===e.count&&($.value=T.value[0].id)})),H=new Date,Y=e=>e<=`${H.getFullYear()}/${H.getMonth()+1}/${H.getDate()}`,F=e=>{x.value.description=e?"Pago de interés":""},A=e=>v(this,void 0,void 0,(function*(){const a=yield i.http.get(`transactions/last/${e}`);D.value=(null===a||void 0===a?void 0:a.balance)||0})),R=()=>{r.storage.set("create",!0),k.push("/treasury/accounts")};return(0,t.YP)($,(e=>v(this,void 0,void 0,(function*(){S.value=!1,P.value=`${I}&id_account=${e}`,yield A(e),(0,t.Y3)((()=>S.value=!0))})))),(0,t.wF)((()=>v(this,void 0,void 0,(function*(){yield z(),$.value&&(yield A($.value))})))),(e,a)=>{const l=(0,t.up)("q-btn"),i=(0,t.up)("q-item-label"),u=(0,t.up)("q-item-section"),r=(0,t.up)("q-item"),s=(0,t.up)("q-select"),c=(0,t.up)("q-tooltip"),v=(0,t.up)("q-chip"),W=(0,t.up)("q-icon"),k=(0,t.up)("q-toolbar-title"),Z=(0,t.up)("q-toolbar"),U=(0,t.up)("q-radio"),Q=(0,t.up)("q-checkbox"),I=(0,t.up)("q-date"),z=(0,t.up)("q-popup-proxy"),H=(0,t.up)("q-input"),A=(0,t.up)("q-card-section"),j=(0,t.up)("q-card-actions"),L=(0,t.up)("q-form"),O=(0,t.up)("q-card"),B=(0,t.up)("q-td"),X=(0,t.up)("q-tr"),G=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)("div",w,[(0,t._)("h2",b,[(0,t.Wm)(l,{icon:"arrow_back",round:"",flat:"",onClick:a[0]||(a[0]=a=>e.$router.push(`/treasury/entryexpense/${e.$route.params.entryId}/${e.$route.params.expenseId}`))}),(0,t.Uk)(" Transacciones bancarias ")]),S.value?((0,t.wg)(),(0,t.j4)(s,{key:0,filled:"",label:"Cuenta bancaria",modelValue:$.value,"onUpdate:modelValue":a[1]||(a[1]=e=>$.value=e),"option-value":"id","option-label":"number",options:T.value,rules:[(0,o.SU)(p.Z).required],"emit-value":"","map-options":""},{option:(0,t.w5)((e=>[(0,t.Wm)(r,(0,n.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{innerHTML:e.opt.number},null,8,["innerHTML"]),(0,t.Wm)(i,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.opt.bank)+" - "+(0,n.zw)(e.opt.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","rules"])):((0,t.wg)(),(0,t.iD)("div",f,[(0,t.Uk)(" No tiene cuentas bancarias asociadas, puede agregarlas "),(0,t._)("a",{onClick:R,href:"javascript:void(0)"},"aquí"),(0,t.Uk)(". ")])),S.value?((0,t.wg)(),(0,t.j4)(m.Z,{key:2,columns:C,filters:V.value,url:P.value,order:"-transaction.id"},{buttons:(0,t.w5)((e=>[(0,t.Wm)(l,{class:"q-ml-none q-mr-xs",icon:"add","no-caps":"",color:"primary",onClick:a=>N(e.open)},{default:(0,t.w5)((()=>[(0,t.Uk)(" Agregar transacción "),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Agregar transacción")])),_:1})])),_:2},1032,["onClick"])])),"buttons-end":(0,t.w5)((()=>{var a;return[(0,t.Wm)(v,{square:"",color:"positive","text-color":"white",label:`TOTAL SALDO: ${D.value} ${null===(a=e.$store.state.user)||void 0===a?void 0:a.user.company.money}`},null,8,["label"])]})),form:(0,t.w5)((e=>[(0,t.Wm)(O,{class:"modal-sm"},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"q-pa-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{name:"point_of_sale",size:"md"}),(0,t.Wm)(k,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(x.value.id?"Editar":"Agregar")+" transacción ",1)])),_:1}),(0,t.Wm)(l,{flat:"",round:"",dense:"",icon:"close",onClick:a=>e.close()},null,8,["onClick"])])),_:2},1024),(0,t.Wm)(L,{onSubmit:a=>M(e),ref:"myForm"},{default:(0,t.w5)((()=>[(0,t.Wm)(A,{class:"q-col-gutter-sm"},{default:(0,t.w5)((()=>[(0,t._)("div",y,[(0,t._)("div",h,[g,(0,t.Wm)(U,{modelValue:x.value.type,"onUpdate:modelValue":a[2]||(a[2]=e=>x.value.type=e),val:"ENTRY",label:"Ingreso"},null,8,["modelValue"]),(0,t.Wm)(U,{modelValue:x.value.type,"onUpdate:modelValue":a[3]||(a[3]=e=>x.value.type=e),val:"EXPENSE",label:"Salida"},null,8,["modelValue"])]),(0,t._)("div",_,["ENTRY"===x.value.type?((0,t.wg)(),(0,t.j4)(Q,{key:0,modelValue:x.value.interest,"onUpdate:modelValue":a[4]||(a[4]=e=>x.value.interest=e),label:"Interés bancario",class:"transaction-interest",onClick:a[5]||(a[5]=e=>F(x.value.interest))},null,8,["modelValue"])):(0,t.kq)("",!0)])]),(0,t.Wm)(H,{filled:"",label:"Fecha movimiento",modelValue:x.value.date,"onUpdate:modelValue":a[7]||(a[7]=e=>x.value.date=e),rules:[(0,o.SU)(p.Z).date,(0,o.SU)(p.Z).required]},{append:(0,t.w5)((()=>[(0,t.Wm)(W,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{ref:"birthdayDateProxy",cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{modelValue:x.value.date,"onUpdate:modelValue":a[6]||(a[6]=e=>x.value.date=e),minimal:"",mask:"DD/MM/YYYY",options:Y},{default:(0,t.w5)((()=>[(0,t._)("div",q,[(0,t.wy)((0,t.Wm)(l,{label:"Cerrar",color:"primary",flat:""},null,512),[[G]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,t.Wm)(H,{filled:"",label:"Descripción",autogrow:"",modelValue:x.value.description,"onUpdate:modelValue":a[8]||(a[8]=e=>x.value.description=e),rules:[(0,o.SU)(p.Z).required]},null,8,["modelValue","rules"]),(0,t.Wm)(H,{filled:"",label:"Monto",modelValue:x.value.amount,"onUpdate:modelValue":a[9]||(a[9]=e=>x.value.amount=e),rules:[(0,o.SU)(p.Z).required]},null,8,["modelValue","rules"])])),_:1}),(0,t.Wm)(j,{align:"right"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(l,{label:"Cancelar",icon:"cancel"},null,512),[[G]]),(0,t.Wm)(l,{type:"submit",label:"Guardar",icon:"check",color:"primary"})])),_:1})])),_:2},1032,["onSubmit"])])),_:2},1024)])),row:(0,t.w5)((e=>[(0,t.Wm)(X,{class:(0,n.C_)({selected:e.row.interest})},{default:(0,t.w5)((()=>[(0,t.Wm)(B,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)((0,o.SU)(d.WU)(e.row.date)),1)])),_:2},1024),(0,t.Wm)(B,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.row.description),1)])),_:2},1024),(0,t.Wm)(B,{class:"text-right"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)("EXPENSE"===e.row.type?"-":"")+(0,n.zw)(e.row.amount),1)])),_:2},1024),(0,t.Wm)(B,{class:"text-right"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.row.balance),1)])),_:2},1024),(0,t.Wm)(B,{class:"text-right"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{square:"",dense:"",color:E[e.row.state].color,"text-color":E[e.row.state].textColor,label:E[e.row.state].label},null,8,["color","text-color","label"])])),_:2},1024)])),_:2},1032,["class"])])),_:1},8,["filters","url"])):(0,t.kq)("",!0)])}}});var k=l(2165),Z=l(2448),U=l(3414),C=l(2035),V=l(2350),E=l(5363),Q=l(7030),x=l(151),T=l(9570),$=l(4554),S=l(3747),D=l(8689),I=l(5589),P=l(7991),N=l(5735),M=l(4689),z=l(3944),H=l(5836),Y=l(9367),F=l(8186),A=l(3884),R=l(677),j=l(7518),L=l.n(j);const O=W,B=O;L()(W,"components",{QBtn:k.Z,QSelect:Z.Z,QItem:U.Z,QItemSection:C.Z,QItemLabel:V.Z,QTooltip:E.Z,QChip:Q.Z,QCard:x.Z,QToolbar:T.Z,QIcon:$.Z,QToolbarTitle:S.Z,QForm:D.Z,QCardSection:I.Z,QRadio:P.Z,QCheckbox:N.Z,QInput:M.Z,QPopupProxy:z.Z,QDate:H.Z,QCardActions:Y.Z,QTr:F.Z,QTd:A.Z}),L()(W,"directives",{ClosePopup:R.Z})}}]);