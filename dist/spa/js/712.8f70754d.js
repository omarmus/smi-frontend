"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[712],{3712:(e,t,o)=>{o.r(t),o.d(t,{default:()=>N});var l=o(3673),a=o(2323),n=o(1959),s=o(8880),r=o(8339),i=o(2993),u=o(925),c=o(9236),d=function(e,t,o,l){function a(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,n){function s(e){try{i(l.next(e))}catch(t){n(t)}}function r(e){try{i(l["throw"](e))}catch(t){n(t)}}function i(e){e.done?o(e.value):a(e.value).then(s,r)}i((l=l.apply(e,t||[])).next())}))};const p=e=>((0,l.dD)("data-v-31b951a1"),e=e(),(0,l.Cn)(),e),v={class:"container"},m={class:"treasury-title"},b={class:"q-pb-md row q-col-gutter-sm"},y={class:"col-xs-12 col-sm-4"},w={class:"col-xs-12 col-sm-5"},f={class:"col-xs-12 col-sm-3"},h={class:"col-xs-12 q-mb-lg"},g={id:"report-content",class:"q-table-simple q-table__container q-table--horizontal-separator column no-wrap q-table--dense q-table--no-wrap table-responsive"},k={id:"pdf-title",class:"treasury-title q-mt-lg",style:{display:"none"}},_={key:0,class:"q-table treasury-table-data"},D=p((()=>(0,l._)("th",null,"Nombre completo",-1))),U={colspan:"13",class:"treasury-section-cell"},z={key:0,class:"treasury-observation"},q={class:"flow-row-table"},C={class:"text-hidden"},V={key:0,class:"flow-row-content text-right"},H={class:"treasury-list-concepts"},x={class:"treasury-observation-report"},O={key:0,class:"treasury-list-concepts"},S={class:"treasury-observation-report"},$=["onClick"],E={key:1,class:"treasury-observation text-right"},M={key:1,class:"alert alert-info"},Y=(0,l.aZ)({__name:"Offerings",setup(e){var t,o,p;const Y=(0,c.o)(),Z=(0,r.tv)(),j=(0,n.iH)({}),I=(0,n.iH)(""),L=(0,n.iH)(!1),T=(0,n.iH)((new Date).getFullYear()),Q=Number(null===(p=null===(o=null===(t=Y.state.user)||void 0===t?void 0:t.user)||void 0===o?void 0:o.company)||void 0===p?void 0:p.id),R=(0,u.V4)(),W=()=>Z.push("/treasury/reports"),B={member:"Miembro",sympathizer:"Miembro Esc. sabática",visit:"Visita"};function K(e){var t;const o=null===(t=e.type)||void 0===t?void 0:t.toLowerCase();return"member"===o?e.id_company===Q?"Miembro":"Miembro de otra iglesia":"sympathizer"===o||"baptismal_candidate"===o?"Miembro Esc. sabática":"visit"===o?"Visita":"Otros"}const N=()=>d(this,void 0,void 0,(function*(){const e=yield i.http.get(`entries/report/offerings-by-church?year=${T.value}&id_company=${Q}&id_department=0`),t=e&&"object"===typeof e&&"data"in e?e.data:e,o=null!==t&&void 0!==t?t:{};for(const l in o)o[l]&&"object"===typeof o[l]&&(o[l].active=!1);j.value=o}));(0,l.YP)(T,N);const F=(0,l.Fl)((()=>{var e;const t=null!==(e=j.value)&&void 0!==e?e:{};return Object.keys(t).length>0})),P=(0,l.Fl)((()=>{var e,t,o;const l=null!==(e=j.value)&&void 0!==e?e:{};if(""!==I.value){const e={};for(const o in l)l[o].label.toLowerCase().includes(I.value.toLowerCase())&&(!L.value||L.value&&"MEMBER"===(null===(t=l[o].type)||void 0===t?void 0:t.toUpperCase()))&&(e[o]=l[o]);return e}if(L.value){const e={};for(const t in l)"MEMBER"===(null===(o=l[t].type)||void 0===o?void 0:o.toUpperCase())&&(e[t]=l[t]);return e}return l})),A=(0,l.Fl)((()=>{var e;const t=null!==(e=P.value)&&void 0!==e?e:{},o=Object.keys(t);if(0===o.length)return[];const l=[];let a="";for(const n of o){const e=t[n],o=K(e);o!==a&&(a=o,l.push({type:"section",label:o})),l.push({type:"user",key:n,user:e})}return l})),G=e=>{const t=[];for(const o in e)e[o].group&&["TITHES","SCOOP"].includes(e[o].group)&&t.push(e[o]);return t},J=()=>d(this,void 0,void 0,(function*(){var e;const t=yield i.http.get(`entries/report/offerings-by-church/pdf?year=${T.value}&id_company=${Q}&id_department=0`),o="string"===typeof t?t:null===t||void 0===t?void 0:t.data;if(!o)return;const l=Uint8Array.from(atob(o),(e=>e.charCodeAt(0))),a=new Blob([l],{type:"application/pdf"}),n=URL.createObjectURL(a),s=`informe-ofrendas-${(null===(e=Y.state.user.user.company)||void 0===e?void 0:e.name)||"iglesia"}-${T.value}-${Date.now()}.pdf`,r=document.createElement("a");r.href=n,r.download=s,r.click(),URL.revokeObjectURL(n)}));return(0,l.bv)(N),(e,t)=>{var o,r;const i=(0,l.up)("q-btn"),c=(0,l.up)("q-select"),d=(0,l.up)("q-icon"),p=(0,l.up)("q-input"),Z=(0,l.up)("q-checkbox");return(0,l.wg)(),(0,l.iD)("div",v,[(0,l._)("h2",m,[(0,l.Wm)(i,{icon:"arrow_back",round:"",flat:"",onClick:W}),(0,l.Uk)(" Informe de ofrendas y diezmos - "+(0,a.zw)(null===(o=(0,n.SU)(Y).state.user.user.company)||void 0===o?void 0:o.name),1)]),(0,l._)("div",b,[(0,l._)("div",y,[(0,l.Wm)(c,{filled:"",modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=e=>T.value=e),options:(0,n.SU)(R),label:"Gestión"},null,8,["modelValue","options"])]),(0,l._)("div",w,[(0,l.Wm)(p,{filled:"",label:"Buscar por Nombre o apellido",modelValue:I.value,"onUpdate:modelValue":t[2]||(t[2]=e=>I.value=e),"input-debounce":"1000",placeholder:"Escribe el nombre o apellido de la persona a buscar"},(0,l.Nv)({_:2},[I.value.length>0?{name:"append",fn:(0,l.w5)((()=>[(0,l.Wm)(d,{name:"close",onClick:t[1]||(t[1]=e=>I.value=""),class:"cursor-pointer"})])),key:"0"}:void 0]),1032,["modelValue"])]),(0,l._)("div",f,[(0,l.Wm)(Z,{modelValue:L.value,"onUpdate:modelValue":t[3]||(t[3]=e=>L.value=e),label:"Ver solo miembros"},null,8,["modelValue"])])]),(0,l._)("div",h,[(0,l.Wm)(i,{icon:"print","no-caps":"",label:"Imprimir",onClick:J})]),(0,l._)("div",g,[(0,l._)("h2",k," Ofrendas y diezmos "+(0,a.zw)(null===(r=(0,n.SU)(Y).state.user.user.company)||void 0===r?void 0:r.name)+" - Gestión "+(0,a.zw)(T.value),1),(0,n.SU)(F)?((0,l.wg)(),(0,l.iD)("table",_,[(0,l._)("thead",null,[(0,l._)("tr",null,[D,((0,l.wg)(),(0,l.iD)(l.HY,null,(0,l.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(e=>(0,l._)("th",{key:e},(0,a.zw)((0,n.SU)(u.e7)[e-1]),1))),64))])]),(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,n.SU)(A),((t,o)=>{var r;return(0,l.wg)(),(0,l.iD)(l.HY,null,["section"===t.type?((0,l.wg)(),(0,l.iD)("tr",{key:`section-${t.label}-${o}`,class:"treasury-section-row"},[(0,l._)("td",U,(0,a.zw)(t.label),1)])):((0,l.wg)(),(0,l.iD)("tr",{key:t.key},[(0,l._)("td",null,[(0,l.Uk)((0,a.zw)(t.user.label)+" ",1),t.user.type?((0,l.wg)(),(0,l.iD)("span",z,(0,a.zw)(B[t.user.type])+" "+(0,a.zw)((null===(r=e.$store.state.user.user.company)||void 0===r?void 0:r.name)!==t.user.church?`- ${t.user.church}`:""),1)):(0,l.kq)("",!0)]),((0,l.wg)(),(0,l.iD)(l.HY,null,(0,l.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(e=>(0,l._)("td",{key:e},[(0,l._)("div",q,[(0,l._)("span",C,(0,a.zw)((0,n.SU)(u.e7)[e-1])+":",1),t.user.months&&t.user.months[e]?((0,l.wg)(),(0,l.iD)("div",V,[(0,l._)("ul",H,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(G(t.user.months[e]),(e=>((0,l.wg)(),(0,l.iD)("li",{key:e.id},[(0,l._)("span",x,(0,a.zw)(e.label)+": ",1),(0,l.Uk)(),(0,l._)("strong",null,(0,a.zw)(e.value),1)])))),128))]),!0===t.user.active?((0,l.wg)(),(0,l.iD)("ul",O,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.user.months[e],(e=>((0,l.wg)(),(0,l.iD)("li",{key:e.id},["TITHES"!==e.group&&"SCOOP"!==e.group?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("span",S,(0,a.zw)(e.label)+": ",1),(0,l.Uk)(),(0,l._)("strong",null,(0,a.zw)(e.value),1)],64)):(0,l.kq)("",!0)])))),128))])):(0,l.kq)("",!0),Object.keys(t.user.months[e]).length>G(t.user.months[e]).length?((0,l.wg)(),(0,l.iD)("a",{key:1,class:"flow-row-link",href:"",onClick:(0,s.iM)((e=>t.user.active=!t.user.active),["prevent"])},(0,a.zw)(!0===t.user.active?"Ver menos":"Ver más"),9,$)):(0,l.kq)("",!0)])):((0,l.wg)(),(0,l.iD)("span",E,"-"))])]))),64))]))],64)})),256))])])):((0,l.wg)(),(0,l.iD)("div",M,"No existe información para la gestión "+(0,a.zw)(T.value),1))])])}}});var Z=o(4260),j=o(2165),I=o(2448),L=o(4689),T=o(4554),Q=o(5735),R=o(6429),W=o(7518),B=o.n(W);const K=(0,Z.Z)(Y,[["__scopeId","data-v-31b951a1"]]),N=K;B()(Y,"components",{QBtn:j.Z,QSelect:I.Z,QInput:L.Z,QIcon:T.Z,QCheckbox:Q.Z,QTable:R.Z})}}]);