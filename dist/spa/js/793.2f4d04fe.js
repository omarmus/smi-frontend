"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[793],{3793:(e,l,o)=>{o.r(l),o.d(l,{default:()=>Y});var t=o(3673),i=o(1959),a=o(2323),u=o(4220),n=o(2993),s=o(4781),r=o(8339),d=o(8719),v=o(9236),p=function(e,l,o,t){function i(e){return e instanceof o?e:new o((function(l){l(e)}))}return new(o||(o=Promise))((function(o,a){function u(e){try{s(t.next(e))}catch(l){a(l)}}function n(e){try{s(t["throw"](e))}catch(l){a(l)}}function s(e){e.done?o(e.value):i(e.value).then(u,n)}s((t=t.apply(e,l||[])).next())}))};const c=(0,t._)("div",{class:"layout-menu"},[(0,t._)("h1",{class:"header-icon"}," Secretaría & Tesorería ")],-1),m={class:"personal q-ma-md"},h=["src","alt"],g={key:1},f={class:"personal-datos"},w={class:"personal-name"},y={class:"personal-company"},b=(0,t.aZ)({__name:"Menu",setup(e){var l,o,b,_,S,k,I,R,C,T,W,q;const A=(0,v.o)(),Z=(0,r.tv)(),Q=(0,i.iH)(),H=(0,i.iH)(),$=(0,i.iH)([]),O=(0,i.iH)([]),U=(0,i.iH)([]),j=(0,i.iH)(),x=(0,i.iH)(),D=(0,i.iH)(Number(null===(b=null===(o=null===(l=A.state.user)||void 0===l?void 0:l.user)||void 0===o?void 0:o.company)||void 0===b?void 0:b.id)),N=[d.j.SUPERADMINISTRATOR].includes(null===(k=null===(S=null===(_=null===A||void 0===A?void 0:A.state)||void 0===_?void 0:_.user)||void 0===S?void 0:S.role)||void 0===k?void 0:k.slug),V=[d.j.ADMINISTRATOR_UNION,d.j.ADMINISTRATOR_ASSOCIATION].includes(null===(C=null===(R=null===(I=null===A||void 0===A?void 0:A.state)||void 0===I?void 0:I.user)||void 0===R?void 0:R.role)||void 0===C?void 0:C.slug),E=(0,i.iH)([d.j.WORKER,d.j.ADMINISTRATOR_ASSOCIATION].includes(null===(q=null===(W=null===(T=null===A||void 0===A?void 0:A.state)||void 0===T?void 0:T.user)||void 0===W?void 0:W.role)||void 0===q?void 0:q.slug));function M(){u.auth.logout("store")}const P=e=>"/treasury/entryexpense/"===e.path?Y():Z.push(e.path),Y=()=>p(this,void 0,void 0,(function*(){const e=s.storage.get("initial");if(e)return Z.push("/treasury/flows/initial");j.value=yield n.http.get(`entries/year/${L}/${D.value}`),x.value=yield n.http.get(`expenses/year/${L}/${D.value}`);const l=j.value.rows.find((e=>"ACTIVE"===e.state)),o=x.value.rows.find((e=>"ACTIVE"===e.state));return l&&o?Z.push(`/treasury/entryexpense/${String(l.id)}/${String(o.id)}`):Z.push("/treasury/months")})),z=(e,l)=>{l(""===e?()=>O.value=$.value:()=>{const l=e.toLowerCase();O.value=$.value.filter((e=>e.name.toLowerCase().indexOf(l)>-1))})},L=(new Date).getUTCFullYear();(0,t.YP)(Q,(()=>p(this,void 0,void 0,(function*(){var e,l,o;if("number"===typeof Q.value){const t=yield n.http.get(`auth/token/${String(Q.value)}`);return s.storage.set("role",t.role),s.storage.set("menu",t.menu),s.storage.set("permissions",t.permissions),s.storage.set("token",t.token),u.auth.initStore(),F(),E.value=[d.j.WORKER,d.j.ADMINISTRATOR_ASSOCIATION].includes(null===(o=null===(l=null===(e=null===A||void 0===A?void 0:A.state)||void 0===e?void 0:e.user)||void 0===l?void 0:l.role)||void 0===o?void 0:o.slug),Z.push("/")}})))),(0,t.YP)(D,(()=>p(this,void 0,void 0,(function*(){var e,l,o,t;if("number"===typeof D.value){const i=null!==(o=null===(l=null===(e=A.state.user)||void 0===e?void 0:e.role)||void 0===l?void 0:l.id)&&void 0!==o?o:"number"===typeof Q.value?Q.value:null===(t=Q.value)||void 0===t?void 0:t.id,a=null!=i?`?roleId=${String(i)}`:"",s=yield n.http.get(`auth/token/company/${String(D.value)}${a}`);return(0,u.initStorage)(s),u.auth.initStore(),F(),Z.push("/")}}))));const F=()=>{var e,l,o,t,i,a,u,n,r,d,v,p,c,m,h,g,f,w,y,b,_;H.value=A.state.user.roles,Q.value=A.state.user.role;const S=s.storage.get("initial");if(U.value=[],!["TREASURER"].includes(null===(e=A.state.user.role)||void 0===e?void 0:e.slug)){const e={path:"/secretary",label:"Secretaría",icon:"edit_note",items:[]};(null===(o=null===(l=A.state.user)||void 0===l?void 0:l.permissions)||void 0===o?void 0:o.includes("company:read"))&&(null===(t=e.items)||void 0===t||t.push({path:"/secretary/churchs",label:"Iglesias"})),(null===(a=null===(i=A.state.user)||void 0===i?void 0:i.permissions)||void 0===a?void 0:a.includes("user:read"))&&(null===(u=e.items)||void 0===u||u.push({path:"/secretary/members",label:"Miembros y usuarios"})),(null===(r=null===(n=A.state.user)||void 0===n?void 0:n.permissions)||void 0===r?void 0:r.includes("department:read"))&&(N||V)&&(null===(d=e.items)||void 0===d||d.push({path:"/secretary/departments",label:"Departamentos"})),U.value.push(e)}if(!["SECRETARY"].includes(null===(p=null===(v=A.state.user)||void 0===v?void 0:v.role)||void 0===p?void 0:p.slug)){const e={path:"/treasury",label:"Tesorería",icon:"monetization_on",items:[]};(null===(m=null===(c=A.state.user)||void 0===c?void 0:c.permissions)||void 0===m?void 0:m.includes("entry:read"))&&(null===(h=e.items)||void 0===h||h.push({path:"/treasury/entryexpense/",label:"Ingresos y Gastos"})),(null===(f=null===(g=A.state.user)||void 0===g?void 0:g.permissions)||void 0===f?void 0:f.includes("account:read"))&&!S&&(null===(w=e.items)||void 0===w||w.push({path:"/treasury/accounts",label:"Cuentas bancarias"})),(null===(b=null===(y=A.state.user)||void 0===y?void 0:y.permissions)||void 0===b?void 0:b.includes("balance:read"))&&!S&&(null===(_=e.items)||void 0===_||_.push({path:"/treasury/reports",label:"Reportes"})),U.value.push(e)}};return(0,t.bv)((()=>p(this,void 0,void 0,(function*(){const e=yield n.http.get("companies");$.value=e.rows.filter((e=>e.type&&["CHURCH","GROUP"].includes(e.type))),O.value=e.rows.filter((e=>e.type&&["CHURCH","GROUP"].includes(e.type))),F()})))),(e,l)=>{const o=(0,t.up)("q-avatar"),u=(0,t.up)("q-separator"),s=(0,t.up)("q-select"),r=(0,t.up)("q-item-section"),d=(0,t.up)("q-item"),v=(0,t.up)("q-list"),p=(0,t.up)("q-expansion-item"),b=(0,t.up)("q-icon"),_=(0,t.up)("q-scroll-area"),S=(0,t.Q2)("ripple");return(0,t.wg)(),(0,t.j4)(_,{class:"fit"},{default:(0,t.w5)((()=>{var _,k,I,R,C,T;return[c,(0,t._)("div",m,[(0,t.Wm)(o,{size:"48px",color:"white"},{default:(0,t.w5)((()=>{var l,o,u,s,r,d,v,p,c,m,f;return[(null===(o=null===(l=e.$store.state.user)||void 0===l?void 0:l.user)||void 0===o?void 0:o.photo)?((0,t.wg)(),(0,t.iD)("img",{key:0,src:`${null===(u=(0,i.SU)(n.urlBase))||void 0===u?void 0:u.replace(/\/api\//g,"")}/files/users/${null===(r=null===(s=e.$store.state.user)||void 0===s?void 0:s.user)||void 0===r?void 0:r.photo}`,alt:null===(p=null===(v=null===(d=e.$store.state.user)||void 0===d?void 0:d.user)||void 0===v?void 0:v.username)||void 0===p?void 0:p.substring(0,2).toUpperCase()},null,8,h)):((0,t.wg)(),(0,t.iD)("span",g,(0,a.zw)(null===(f=null===(m=null===(c=e.$store.state.user)||void 0===c?void 0:c.user)||void 0===m?void 0:m.username)||void 0===f?void 0:f.substring(0,2).toUpperCase()),1))]})),_:1}),(0,t._)("div",f,[(0,t._)("div",w,(0,a.zw)(null===(k=null===(_=e.$store.state.user)||void 0===_?void 0:_.user)||void 0===k?void 0:k.fullname),1),(0,t._)("div",y,(0,a.zw)(null===(C=null===(R=null===(I=e.$store.state.user)||void 0===I?void 0:I.user)||void 0===R?void 0:R.company)||void 0===C?void 0:C.name),1)])]),(0,t.Wm)(u),H.value&&(null===(T=H.value)||void 0===T?void 0:T.length)>1?((0,t.wg)(),(0,t.j4)(s,{key:0,square:"",standout:"",color:"teal",label:"Rol seleccionado",modelValue:Q.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Q.value=e),options:H.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dark:""},null,8,["modelValue","options"])):(0,t.kq)("",!0),E.value?((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[(0,t.Wm)(u),(0,t.Wm)(s,{filled:"",modelValue:D.value,"onUpdate:modelValue":l[1]||(l[1]=e=>D.value=e),options:O.value,label:"Iglesia seleccionada","option-value":"id","option-label":"name","emit-value":"","map-options":"","use-input":"","input-debounce":"200",onFilter:z,dark:""},null,8,["modelValue","options"])],64)):(0,t.kq)("",!0),(0,t.Wm)(u),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(U.value,(l=>((0,t.wg)(),(0,t.j4)(p,{group:"somegroup",icon:l.icon,label:l.label,"header-class":"text-white menu-list",key:l.path},{default:(0,t.w5)((()=>[l.items?((0,t.wg)(),(0,t.j4)(v,{key:0,padding:"",class:"menu-list menu-sublist"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.items,(l=>(0,t.wy)(((0,t.wg)(),(0,t.j4)(d,{key:l.path,onClick:e=>P(l),active:-1!==e.$route.path.indexOf(l.path),clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{avatar:"",class:"layout-menu-icon"}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,a.zw)(l.label),1)])),_:2},1024)])),_:2},1032,["onClick","active"])),[[S]]))),128))])),_:2},1024)):(0,t.kq)("",!0)])),_:2},1032,["icon","label"])))),128))])),_:1}),(0,t.Wm)(u),(0,t.Wm)(v,{padding:"",class:"menu-list"},{default:(0,t.w5)((()=>[(0,t.wy)(((0,t.wg)(),(0,t.j4)(d,{onClick:M,clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{avatar:"",class:"layout-menu-icon"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{name:"logout",class:"color-texto"})])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Salir de sistema")])),_:1})])),_:1})),[[S]])])),_:1})]})),_:1})}}});var _=o(7704),S=o(2165),k=o(5096),I=o(5869),R=o(2448),C=o(7011),T=o(4615),W=o(3414),q=o(2035),A=o(4554),Z=o(6489),Q=o(7518),H=o.n(Q);const $=b,O=$;H()(b,"components",{QScrollArea:_.Z,QBtn:S.Z,QAvatar:k.Z,QSeparator:I.Z,QSelect:R.Z,QList:C.Z,QExpansionItem:T.Z,QItem:W.Z,QItemSection:q.Z,QIcon:A.Z}),H()(b,"directives",{Ripple:Z.Z});const U={__name:"MainLayout",setup(e){const l=(0,i.iH)(!1);function o(){l.value=!l.value}return(e,a)=>{const u=(0,t.up)("q-btn"),n=(0,t.up)("q-space"),s=(0,t.up)("q-toolbar"),r=(0,t.up)("q-header"),d=(0,t.up)("q-drawer"),v=(0,t.up)("router-view"),p=(0,t.up)("q-page-container"),c=(0,t.up)("q-layout");return(0,t.wg)(),(0,t.j4)(c,{view:"lHh lpR lFf"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{class:"q-header-main"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{flat:"",dense:"",round:"",class:"warning-light",icon:"menu","aria-label":"Menu",onClick:o}),(0,t.Wm)(n)])),_:1})])),_:1}),(0,t.Wm)(d,{"show-if-above":"",modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),side:"left",bordered:"",width:270,class:"sidebar"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(O))])),_:1},8,["modelValue"]),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(v)])),_:1})])),_:1})}}};var j=o(9214),x=o(3812),D=o(9570),N=o(2025),V=o(2901),E=o(2652),M=o(1762);const P=U,Y=P;H()(U,"components",{QLayout:j.Z,QHeader:x.Z,QToolbar:D.Z,QBtn:S.Z,QIcon:A.Z,QSpace:N.Z,QDrawer:V.Z,QPageContainer:E.Z,QFooter:M.Z})}}]);