"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[104],{3104:(e,t,l)=>{l.r(t),l.d(t,{default:()=>F});var n=l(3673),o=l(2323),a=l(1959),s=l(8339),r=l(2993),i=l(925),c=l(2505),u=l.n(c),d=function(e,t,l,n){function o(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,a){function s(e){try{i(n.next(e))}catch(t){a(t)}}function r(e){try{i(n["throw"](e))}catch(t){a(t)}}function i(e){e.done?l(e.value):o(e.value).then(s,r)}i((n=n.apply(e,t||[])).next())}))};const v={class:"container"},m={class:"treasury-title"},p={class:"q-pb-md row q-col-gutter-sm"},h={class:"col-xs-12 col-sm-8"},f={key:0},w={class:"col-xs-12 q-mb-lg"},b={id:"report-content",class:"q-mb-lg"},y={class:"treasury-title"},g={class:"col-xs-12 col-sm-8 q-table-simple q-table__container q-table--horizontal-separator column no-wrap q-table--dense q-table--no-wrap table-responsive"},_={class:"q-mb-md treasury-subtitle"},k={class:"q-table"},q=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",{class:"text-left",style:{width:"25%"}},[(0,n._)("strong",null,"Mes")]),(0,n._)("th",{class:"text-left"},[(0,n._)("strong",null,"Descripci칩n")]),(0,n._)("th",{class:"text-left",style:{width:"30%"}},[(0,n._)("strong",null,"Lugar")])])],-1),D={key:0,class:"treasury-list-concepts"},z={class:"treasury-observation-report"},S={key:1,class:"treasury-observation"},M={key:1,class:"alert alert-info"},U=(0,n.aZ)({__name:"Offering",setup(e){const t=(0,s.tv)(),l=(0,a.iH)(null),c=(0,a.iH)([]),U=(0,a.iH)([]),x=(0,a.iH)(new Map),C=()=>t.push("/treasury/reports"),H={member:"Miembro",sympathizer:"Miembro Esc. sab치tica",visit:"Visita"},I=(e,t)=>{t((()=>{(()=>{d(this,void 0,void 0,(function*(){if(""===e)return void(c.value=[]);const t=`users?order=fullname&fullname=${encodeURIComponent(e)}&all_churchs=true`,l=yield r.http.get(t,!1);c.value=l.rows.map((e=>{var t,l,n;return{value:String(e.id),label:String(null===(t=e.person)||void 0===t?void 0:t.fullname),church:String(null===(l=e.company)||void 0===l?void 0:l.name),association:void 0,type:null===(n=e.type)||void 0===n?void 0:n.toLowerCase(),months:{}}}))}))})()}))};(0,n.YP)(l,(e=>d(this,void 0,void 0,(function*(){e?yield E(e.value):(U.value=[],x.value=new Map)}))));const W=(0,n.Fl)((()=>Array.from(x.value.entries()).sort(((e,t)=>t[0]-e[0])))),Z=()=>{var e;const t=document.getElementById("report-content");if(!t)return;const n={margin:[10,10,10,10],filename:`informe-ofrendas-${(null===(e=l.value)||void 0===e?void 0:e.label)||"usuario"}-${Date.now()}.pdf`,image:{type:"png"},html2canvas:{scale:2.5,useCORS:!0,logging:!1},jsPDF:{unit:"mm",format:"letter",orientation:"portrait"}};u()().set(n).from(t).save()},E=e=>d(this,void 0,void 0,(function*(){var t,n,o,a;U.value=[],x.value=new Map;const s=yield r.http.get(`entriesdetails?id_user=${e}&order=entry_detail.id`),c=new Map;for(const e of s.rows){const s=e.entry.year,r=e.entry.month,i=`${s}-${r}`,u=(null===(n=null===(t=e.user)||void 0===t?void 0:t.company)||void 0===n?void 0:n.name)||(null===(o=l.value)||void 0===o?void 0:o.church)||"";c.has(i)||c.set(i,{year:s,month:r,concepts:[],churches:new Set});const d=c.get(i);if(d){u&&d.churches.add(u);for(const t of e.concepts)(null===(a=t.concept)||void 0===a?void 0:a.label)&&t.value&&d.concepts.push({label:t.concept.label,value:Number(t.value)})}}c.forEach((e=>{var t;const n=e.year,o=e.month,a=e.churches.size>0?Array.from(e.churches)[0]:(null===(t=l.value)||void 0===t?void 0:t.church)||"",s=new Map;e.concepts.forEach((e=>{const t=s.get(e.label)||0;s.set(e.label,t+e.value)}));const r=Array.from(s.entries()).map((([e,t])=>({label:e,value:t}))),c={year:n,month:o,monthName:i.e7[o-1],concepts:r,church:a,date:new Date(n,o-1,1)};U.value.push(c),x.value.has(n)||x.value.set(n,[]);const u=x.value.get(n);u&&u.push(c)})),x.value.forEach(((e,t)=>{var n;const o=new Map;e.forEach((e=>{o.set(e.month,e)}));const a=[];for(let s=1;s<=12;s++){const e=o.get(s);e?a.push(e):a.push({year:t,month:s,monthName:i.e7[s-1],concepts:[],church:(null===(n=l.value)||void 0===n?void 0:n.church)||"",date:new Date(t,s-1,1)})}a.sort(((e,t)=>e.month-t.month)),x.value.set(t,a)}))}));return(e,t)=>{var s,r;const i=(0,n.up)("q-btn"),u=(0,n.up)("q-item-label"),d=(0,n.up)("q-item-section"),U=(0,n.up)("q-item"),x=(0,n.up)("q-select");return(0,n.wg)(),(0,n.iD)("div",v,[(0,n._)("h2",m,[(0,n.Wm)(i,{icon:"arrow_back",round:"",flat:"",onClick:C}),(0,n.Uk)(" Informe de ofrendas y diezmos por persona ")]),(0,n._)("div",p,[(0,n._)("div",h,[(0,n.Wm)(x,{filled:"",label:"Buscar por nombre o apellido",modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),"use-input":"","input-debounce":"600",options:c.value,onFilter:I,clearable:""},{option:(0,n.w5)((e=>[(0,n.Wm)(U,(0,o.vs)((0,n.F4)(e.itemProps)),{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(e.opt.label),1)])),_:2},1024),(0,n.Wm)(u,{caption:""},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(e.opt.church),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options"])])]),l.value&&(0,a.SU)(W).length>0?((0,n.wg)(),(0,n.iD)("div",f,[(0,n._)("div",w,[(0,n.Wm)(i,{icon:"print","no-caps":"",label:"Imprimir",onClick:Z})]),(0,n._)("div",b,[(0,n._)("h2",y," Diezmos y ofrendas de "+(0,o.zw)(null===(s=l.value)||void 0===s?void 0:s.label)+" - "+(0,o.zw)(H[null===(r=l.value)||void 0===r?void 0:r.type]),1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,a.SU)(W),(([e,t])=>((0,n.wg)(),(0,n.iD)("div",{key:e,class:"q-mb-lg row"},[(0,n._)("div",g,[(0,n._)("h3",_,"Gesti칩n "+(0,o.zw)(e),1),(0,n._)("table",k,[q,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t,((e,t)=>((0,n.wg)(),(0,n.iD)("tr",{key:t},[(0,n._)("td",null,(0,o.zw)(e.monthName),1),(0,n._)("td",null,[e.concepts.length>0?((0,n.wg)(),(0,n.iD)("ul",D,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.concepts,((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:t},[(0,n._)("span",z,(0,o.zw)(e.label)+": ",1),(0,n.Uk)(),(0,n._)("strong",null,(0,o.zw)(e.value),1)])))),128))])):((0,n.wg)(),(0,n.iD)("span",S,"-"))]),(0,n._)("td",null,(0,o.zw)(e.concepts.length>0?e.church:"-"),1)])))),128))])])])])))),128))])])):(0,n.kq)("",!0),l.value&&0===(0,a.SU)(W).length?((0,n.wg)(),(0,n.iD)("div",M,"Sin informaci칩n para la persona")):(0,n.kq)("",!0)])}}});var x=l(2165),C=l(2448),H=l(3414),I=l(2035),W=l(2350),Z=l(6429),E=l(7518),Q=l.n(E);const $=U,F=$;Q()(U,"components",{QBtn:x.Z,QSelect:C.Z,QItem:H.Z,QItemSection:I.Z,QItemLabel:W.Z,QTable:Z.Z})}}]);