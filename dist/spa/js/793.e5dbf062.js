"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[793],{3793:(e,l,t)=>{t.r(l),t.d(l,{default:()=>Y});var o=t(3673),i=t(1959),a=t(2323),s=t(4220),u=t(2993),n=t(4781),r=t(8339),d=t(8719),v=t(9236),c=function(e,l,t,o){function i(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,a){function s(e){try{n(o.next(e))}catch(l){a(l)}}function u(e){try{n(o["throw"](e))}catch(l){a(l)}}function n(e){e.done?t(e.value):i(e.value).then(s,u)}n((o=o.apply(e,l||[])).next())}))};const p=(0,o._)("div",{class:"layout-menu"},[(0,o._)("h1",{class:"header-icon"}," Secretaría & Tesorería ")],-1),m={class:"personal q-ma-md"},h=["src","alt"],g={key:1},f={class:"personal-datos"},w={class:"personal-name"},y={class:"personal-company"},b=(0,o.aZ)({__name:"Menu",setup(e){var l,t,b,_,S,k,R,I,C,T,W,q;const A=(0,v.o)(),Z=(0,r.tv)(),Q=(0,i.iH)(),H=(0,i.iH)(),O=(0,i.iH)([]),U=(0,i.iH)([]),$=(0,i.iH)([]),j=(0,i.iH)(),x=(0,i.iH)(),D=(0,i.iH)(Number(null===(b=null===(t=null===(l=A.state.user)||void 0===l?void 0:l.user)||void 0===t?void 0:t.company)||void 0===b?void 0:b.id)),N=[d.j.SUPERADMINISTRATOR].includes(null===(k=null===(S=null===(_=null===A||void 0===A?void 0:A.state)||void 0===_?void 0:_.user)||void 0===S?void 0:S.role)||void 0===k?void 0:k.slug),V=[d.j.ADMINISTRATOR_UNION,d.j.ADMINISTRATOR_ASSOCIATION].includes(null===(C=null===(I=null===(R=null===A||void 0===A?void 0:A.state)||void 0===R?void 0:R.user)||void 0===I?void 0:I.role)||void 0===C?void 0:C.slug),E=(0,i.iH)([d.j.WORKER,d.j.ADMINISTRATOR_ASSOCIATION].includes(null===(q=null===(W=null===(T=null===A||void 0===A?void 0:A.state)||void 0===T?void 0:T.user)||void 0===W?void 0:W.role)||void 0===q?void 0:q.slug));function M(){s.auth.logout("store")}const P=e=>"/treasury/entryexpense/"===e.path?Y():Z.push(e.path),Y=()=>c(this,void 0,void 0,(function*(){const e=n.storage.get("initial");if(e)return Z.push("/treasury/flows/initial");j.value=yield u.http.get(`entries/year/${L}/${D.value}`),x.value=yield u.http.get(`expenses/year/${L}/${D.value}`);const l=j.value.rows.find((e=>"ACTIVE"===e.state)),t=x.value.rows.find((e=>"ACTIVE"===e.state));return l&&t?Z.push(`/treasury/entryexpense/${String(l.id)}/${String(t.id)}`):Z.push("/treasury/months")})),z=(e,l)=>{l(""===e?()=>U.value=O.value:()=>{const l=e.toLowerCase();U.value=O.value.filter((e=>e.name.toLowerCase().indexOf(l)>-1))})},L=(new Date).getUTCFullYear();(0,o.YP)(Q,(()=>c(this,void 0,void 0,(function*(){var e,l,t;if("number"===typeof Q.value){const o=yield u.http.get(`auth/token/${String(Q.value)}`);return n.storage.set("role",o.role),n.storage.set("menu",o.menu),n.storage.set("permissions",o.permissions),n.storage.set("token",o.token),s.auth.initStore(),F(),E.value=[d.j.WORKER,d.j.ADMINISTRATOR_ASSOCIATION].includes(null===(t=null===(l=null===(e=null===A||void 0===A?void 0:A.state)||void 0===e?void 0:e.user)||void 0===l?void 0:l.role)||void 0===t?void 0:t.slug),Z.push("/")}})))),(0,o.YP)(D,(()=>c(this,void 0,void 0,(function*(){if("number"===typeof D.value){const e=yield u.http.get(`auth/token/company/${String(D.value)}`);return(0,s.initStorage)(e),s.auth.initStore(),F(),Z.push("/")}}))));const F=()=>{var e,l,t,o,i,a,s,u,r,d,v,c,p,m,h,g,f,w,y,b,_;H.value=A.state.user.roles,Q.value=A.state.user.role;const S=n.storage.get("initial");if($.value=[],!["TREASURER"].includes(null===(e=A.state.user.role)||void 0===e?void 0:e.slug)){const e={path:"/secretary",label:"Secretaría",icon:"edit_note",items:[]};(null===(t=null===(l=A.state.user)||void 0===l?void 0:l.permissions)||void 0===t?void 0:t.includes("company:read"))&&(null===(o=e.items)||void 0===o||o.push({path:"/secretary/churchs",label:"Iglesias"})),(null===(a=null===(i=A.state.user)||void 0===i?void 0:i.permissions)||void 0===a?void 0:a.includes("user:read"))&&(null===(s=e.items)||void 0===s||s.push({path:"/secretary/members",label:"Miembros y usuarios"})),(null===(r=null===(u=A.state.user)||void 0===u?void 0:u.permissions)||void 0===r?void 0:r.includes("department:read"))&&(N||V)&&(null===(d=e.items)||void 0===d||d.push({path:"/secretary/departments",label:"Departamentos"})),$.value.push(e)}if(!["SECRETARY"].includes(null===(c=null===(v=A.state.user)||void 0===v?void 0:v.role)||void 0===c?void 0:c.slug)){const e={path:"/treasury",label:"Tesorería",icon:"monetization_on",items:[]};(null===(m=null===(p=A.state.user)||void 0===p?void 0:p.permissions)||void 0===m?void 0:m.includes("entry:read"))&&(null===(h=e.items)||void 0===h||h.push({path:"/treasury/entryexpense/",label:"Ingresos y Gastos"})),(null===(f=null===(g=A.state.user)||void 0===g?void 0:g.permissions)||void 0===f?void 0:f.includes("account:read"))&&!S&&(null===(w=e.items)||void 0===w||w.push({path:"/treasury/accounts",label:"Cuentas bancarias"})),(null===(b=null===(y=A.state.user)||void 0===y?void 0:y.permissions)||void 0===b?void 0:b.includes("balance:read"))&&!S&&(null===(_=e.items)||void 0===_||_.push({path:"/treasury/reports",label:"Reportes"})),$.value.push(e)}};return(0,o.bv)((()=>c(this,void 0,void 0,(function*(){const e=yield u.http.get("companies");O.value=e.rows.filter((e=>e.type&&["CHURCH","GROUP"].includes(e.type))),U.value=e.rows.filter((e=>e.type&&["CHURCH","GROUP"].includes(e.type))),F()})))),(e,l)=>{const t=(0,o.up)("q-avatar"),s=(0,o.up)("q-separator"),n=(0,o.up)("q-select"),r=(0,o.up)("q-item-section"),d=(0,o.up)("q-item"),v=(0,o.up)("q-list"),c=(0,o.up)("q-expansion-item"),b=(0,o.up)("q-icon"),_=(0,o.up)("q-scroll-area"),S=(0,o.Q2)("ripple");return(0,o.wg)(),(0,o.j4)(_,{class:"fit"},{default:(0,o.w5)((()=>{var _,k,R,I,C,T;return[p,(0,o._)("div",m,[(0,o.Wm)(t,{size:"48px",color:"white"},{default:(0,o.w5)((()=>{var l,t,s,n,r,d,v,c,p,m,f;return[(null===(t=null===(l=e.$store.state.user)||void 0===l?void 0:l.user)||void 0===t?void 0:t.photo)?((0,o.wg)(),(0,o.iD)("img",{key:0,src:`${null===(s=(0,i.SU)(u.urlBase))||void 0===s?void 0:s.replace(/\/api\//g,"")}/files/users/${null===(r=null===(n=e.$store.state.user)||void 0===n?void 0:n.user)||void 0===r?void 0:r.photo}`,alt:null===(c=null===(v=null===(d=e.$store.state.user)||void 0===d?void 0:d.user)||void 0===v?void 0:v.username)||void 0===c?void 0:c.substring(0,2).toUpperCase()},null,8,h)):((0,o.wg)(),(0,o.iD)("span",g,(0,a.zw)(null===(f=null===(m=null===(p=e.$store.state.user)||void 0===p?void 0:p.user)||void 0===m?void 0:m.username)||void 0===f?void 0:f.substring(0,2).toUpperCase()),1))]})),_:1}),(0,o._)("div",f,[(0,o._)("div",w,(0,a.zw)(null===(k=null===(_=e.$store.state.user)||void 0===_?void 0:_.user)||void 0===k?void 0:k.fullname),1),(0,o._)("div",y,(0,a.zw)(null===(C=null===(I=null===(R=e.$store.state.user)||void 0===R?void 0:R.user)||void 0===I?void 0:I.company)||void 0===C?void 0:C.name),1)])]),(0,o.Wm)(s),H.value&&(null===(T=H.value)||void 0===T?void 0:T.length)>1?((0,o.wg)(),(0,o.j4)(n,{key:0,square:"",standout:"",color:"teal",label:"Rol seleccionado",modelValue:Q.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Q.value=e),options:H.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dark:""},null,8,["modelValue","options"])):(0,o.kq)("",!0),E.value?((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[(0,o.Wm)(s),(0,o.Wm)(n,{filled:"",modelValue:D.value,"onUpdate:modelValue":l[1]||(l[1]=e=>D.value=e),options:U.value,label:"Iglesia seleccionada","option-value":"id","option-label":"name","emit-value":"","map-options":"","use-input":"","input-debounce":"200",onFilter:z,dark:""},null,8,["modelValue","options"])],64)):(0,o.kq)("",!0),(0,o.Wm)(s),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)($.value,(l=>((0,o.wg)(),(0,o.j4)(c,{group:"somegroup",icon:l.icon,label:l.label,"header-class":"text-white menu-list",key:l.path},{default:(0,o.w5)((()=>[l.items?((0,o.wg)(),(0,o.j4)(v,{key:0,padding:"",class:"menu-list menu-sublist"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.items,(l=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(d,{key:l.path,onClick:e=>P(l),active:-1!==e.$route.path.indexOf(l.path),clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{avatar:"",class:"layout-menu-icon"}),(0,o.Wm)(r,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(l.label),1)])),_:2},1024)])),_:2},1032,["onClick","active"])),[[S]]))),128))])),_:2},1024)):(0,o.kq)("",!0)])),_:2},1032,["icon","label"])))),128))])),_:1}),(0,o.Wm)(s),(0,o.Wm)(v,{padding:"",class:"menu-list"},{default:(0,o.w5)((()=>[(0,o.wy)(((0,o.wg)(),(0,o.j4)(d,{onClick:M,clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{avatar:"",class:"layout-menu-icon"},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{name:"logout",class:"color-texto"})])),_:1}),(0,o.Wm)(r,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Salir de sistema")])),_:1})])),_:1})),[[S]])])),_:1})]})),_:1})}}});var _=t(7704),S=t(2165),k=t(5096),R=t(5869),I=t(2448),C=t(7011),T=t(4615),W=t(3414),q=t(2035),A=t(4554),Z=t(6489),Q=t(7518),H=t.n(Q);const O=b,U=O;H()(b,"components",{QScrollArea:_.Z,QBtn:S.Z,QAvatar:k.Z,QSeparator:R.Z,QSelect:I.Z,QList:C.Z,QExpansionItem:T.Z,QItem:W.Z,QItemSection:q.Z,QIcon:A.Z}),H()(b,"directives",{Ripple:Z.Z});const $={__name:"MainLayout",setup(e){const l=(0,i.iH)(!1);function t(){l.value=!l.value}return(e,a)=>{const s=(0,o.up)("q-btn"),u=(0,o.up)("q-space"),n=(0,o.up)("q-toolbar"),r=(0,o.up)("q-header"),d=(0,o.up)("q-drawer"),v=(0,o.up)("router-view"),c=(0,o.up)("q-page-container"),p=(0,o.up)("q-layout");return(0,o.wg)(),(0,o.j4)(p,{view:"lHh lpR lFf"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"q-header-main"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s,{flat:"",dense:"",round:"",class:"warning-light",icon:"menu","aria-label":"Menu",onClick:t}),(0,o.Wm)(u)])),_:1})])),_:1}),(0,o.Wm)(d,{"show-if-above":"",modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),side:"left",bordered:"",width:270,class:"sidebar"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(U))])),_:1},8,["modelValue"]),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v)])),_:1})])),_:1})}}};var j=t(9214),x=t(3812),D=t(9570),N=t(2025),V=t(2901),E=t(2652),M=t(1762);const P=$,Y=P;H()($,"components",{QLayout:j.Z,QHeader:x.Z,QToolbar:D.Z,QBtn:S.Z,QIcon:A.Z,QSpace:N.Z,QDrawer:V.Z,QPageContainer:E.Z,QFooter:M.Z})}}]);