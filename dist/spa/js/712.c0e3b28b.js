"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[712],{3712:(e,l,o)=>{o.r(l),o.d(l,{default:()=>I});var n=o(3673),t=o(2323),a=o(1959),s=o(8880),i=o(8339),r=o(2993),u=o(925),c=o(9236),v=function(e,l,o,n){function t(e){return e instanceof o?e:new o((function(l){l(e)}))}return new(o||(o=Promise))((function(o,a){function s(e){try{r(n.next(e))}catch(l){a(l)}}function i(e){try{r(n["throw"](e))}catch(l){a(l)}}function r(e){e.done?o(e.value):t(e.value).then(s,i)}r((n=n.apply(e,l||[])).next())}))};const d={class:"container"},p={class:"treasury-title"},m={class:"q-pb-md row q-col-gutter-sm"},h={class:"col-xs-12 col-sm-4"},b={class:"col-xs-12 col-sm-5"},y={class:"col-xs-12 col-sm-3"},w={class:"q-table-simple q-table__container q-table--horizontal-separator column no-wrap q-table--dense q-table--no-wrap table-responsive"},f={class:"q-table treasury-table-data"},g=(0,n._)("th",null,"Nombre completo",-1),_={key:0,class:"treasury-observation"},k={class:"flow-row-table"},q={class:"text-hidden"},D={key:0,class:"flow-row-content text-right"},S={class:"treasury-list-concepts"},C={class:"treasury-observation-report"},U={key:0,class:"treasury-list-concepts"},V={class:"treasury-observation-report"},z=["onClick"],H={key:1,class:"treasury-observation"},x=(0,n.aZ)({__name:"Offerings",setup(e){var l,o,x;const E=(0,c.o)(),Y=(0,i.tv)(),M=(0,a.iH)(),T=(0,a.iH)(""),Z=(0,a.iH)(!1),$=(0,a.iH)((new Date).getFullYear()),N=Number(null===(x=null===(o=null===(l=E.state.user)||void 0===l?void 0:l.user)||void 0===o?void 0:o.company)||void 0===x?void 0:x.id),O=(0,u.V4)(),Q=()=>Y.push("/treasury/reports"),I={member:"Miembro",sympathizer:"Miembro Esc. sabática",visit:"Visita"},K=(e,l)=>v(this,void 0,void 0,(function*(){let o="users?order=fullname";o+=e?l?`&fullname=${e}&all_association=true`:`&fullname=${e}&all_churchs=true`:`&id_company=${N}`;const n=yield r.http.get(o,!1),t={};return n.rows.forEach((e=>{var o,n,a,s;t[`user-${e.id||""}`]={value:String(e.id),label:String(null===(o=e.person)||void 0===o?void 0:o.fullname),church:String(null===(n=e.company)||void 0===n?void 0:n.name),association:l?String(null===(a=e.association)||void 0===a?void 0:a.name):void 0,type:null===(s=e.type)||void 0===s?void 0:s.toLowerCase(),months:{}}})),t}));(0,n.YP)($,(()=>v(this,void 0,void 0,(function*(){yield B()}))));const W=(0,n.Fl)((()=>{var e,l;if(""!==T.value){const l={};for(const o in M.value)M.value[o].label.toLowerCase().includes(T.value.toLowerCase())&&(!Z.value||Z.value&&"MEMBER"===(null===(e=M.value[o].type)||void 0===e?void 0:e.toUpperCase()))&&(l[o]=M.value[o]);return l}if(Z.value){const e={};for(const o in M.value)"MEMBER"===(null===(l=M.value[o].type)||void 0===l?void 0:l.toUpperCase())&&(e[o]=M.value[o]);return e}return M.value})),B=()=>v(this,void 0,void 0,(function*(){var e,l,o;for(const t in M.value)M.value[t].months={};const n=yield r.http.get(`entriesdetails?year=${$.value}&id_department=0&order=entry_detail.id`);for(const t of n.rows)if((null===(e=t.user)||void 0===e?void 0:e.id)&&M.value&&M.value[`user-${null===(l=t.user)||void 0===l?void 0:l.id}`]){const e=M.value[`user-${null===(o=t.user)||void 0===o?void 0:o.id}`];if(e.months){e.months[t.entry.month]||(e.months[t.entry.month]={});for(const l of t.concepts)l.concept.value&&(e.months[t.entry.month][l.concept.value]?e.months[t.entry.month][l.concept.value].value+=Number(l.value):e.months[t.entry.month][l.concept.value]={id:String(l.concept.value),type:l.concept.type,label:l.concept.label,group:l.concept.group,value:Number(l.value)})}}})),P=e=>{const l=[];for(const o in e)e[o].group&&["TITHES","SCOOP"].includes(e[o].group)&&l.push(e[o]);return l};return(0,n.bv)((()=>v(this,void 0,void 0,(function*(){M.value=yield K(""),yield B()})))),(e,l)=>{var o;const i=(0,n.up)("q-btn"),r=(0,n.up)("q-select"),c=(0,n.up)("q-icon"),v=(0,n.up)("q-input"),x=(0,n.up)("q-checkbox");return(0,n.wg)(),(0,n.iD)("div",d,[(0,n._)("h2",p,[(0,n.Wm)(i,{icon:"arrow_back",round:"",flat:"",onClick:Q}),(0,n.Uk)(" Informe de ofrendas por persona - "+(0,t.zw)(null===(o=(0,a.SU)(E).state.user.user.company)||void 0===o?void 0:o.name),1)]),(0,n._)("div",m,[(0,n._)("div",h,[(0,n.Wm)(r,{filled:"",modelValue:$.value,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value=e),options:(0,a.SU)(O),label:"Gestión"},null,8,["modelValue","options"])]),(0,n._)("div",b,[(0,n.Wm)(v,{filled:"",label:"Buscar por Nombre o apellido",modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=e=>T.value=e),"input-debounce":"1000",placeholder:"Escribe el nombre o apellido de la persona a buscar"},(0,n.Nv)({_:2},[T.value.length>0?{name:"append",fn:(0,n.w5)((()=>[(0,n.Wm)(c,{name:"close",onClick:l[1]||(l[1]=e=>T.value=""),class:"cursor-pointer"})])),key:"0"}:void 0]),1032,["modelValue"])]),(0,n._)("div",y,[(0,n.Wm)(x,{modelValue:Z.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Z.value=e),label:"Ver solo miembros"},null,8,["modelValue"])])]),(0,n._)("div",w,[(0,n._)("table",f,[(0,n._)("thead",null,[(0,n._)("tr",null,[g,((0,n.wg)(),(0,n.iD)(n.HY,null,(0,n.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(e=>(0,n._)("th",{key:e},(0,t.zw)((0,a.SU)(u.e7)[e-1]),1))),64))])]),(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,a.SU)(W),(e=>((0,n.wg)(),(0,n.iD)("tr",{key:e.value},[(0,n._)("td",null,[(0,n.Uk)((0,t.zw)(e.label)+" ",1),e.type?((0,n.wg)(),(0,n.iD)("span",_,(0,t.zw)(I[e.type]),1)):(0,n.kq)("",!0)]),((0,n.wg)(),(0,n.iD)(n.HY,null,(0,n.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(l=>(0,n._)("td",{key:l},[(0,n._)("div",k,[(0,n._)("span",q,(0,t.zw)((0,a.SU)(u.e7)[l-1])+":",1),e.months&&e.months[l]?((0,n.wg)(),(0,n.iD)("div",D,[(0,n._)("ul",S,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(P(e.months[l]),(e=>((0,n.wg)(),(0,n.iD)("li",{key:e.id},[(0,n._)("span",C,(0,t.zw)(e.label)+": ",1),(0,n.Uk)(),(0,n._)("strong",null,(0,t.zw)(e.value),1)])))),128))]),!0===e.active?((0,n.wg)(),(0,n.iD)("ul",U,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.months[l],(e=>((0,n.wg)(),(0,n.iD)("li",{key:e.id},["TITHES"!==e.group&&"SCOOP"!==e.group?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("span",V,(0,t.zw)(e.label)+": ",1),(0,n.Uk)(),(0,n._)("strong",null,(0,t.zw)(e.value),1)],64)):(0,n.kq)("",!0)])))),128))])):(0,n.kq)("",!0),Object.keys(e.months[l]).length>P(e.months[l]).length?((0,n.wg)(),(0,n.iD)("a",{key:1,class:"flow-row-link",href:"",onClick:(0,s.iM)((l=>e.active=!e.active),["prevent"])},(0,t.zw)(!0===e.active?"Ver menos":"Ver más"),9,z)):(0,n.kq)("",!0)])):((0,n.wg)(),(0,n.iD)("span",H,"-"))])]))),64))])))),128))])])])])}}});var E=o(2165),Y=o(2448),M=o(4689),T=o(4554),Z=o(5735),$=o(6429),N=o(7518),O=o.n(N);const Q=x,I=Q;O()(x,"components",{QBtn:E.Z,QSelect:Y.Z,QInput:M.Z,QIcon:T.Z,QCheckbox:Z.Z,QTable:$.Z})}}]);