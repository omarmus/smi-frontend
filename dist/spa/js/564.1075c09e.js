"use strict";(self["webpackChunksmi_frontend"]=self["webpackChunksmi_frontend"]||[]).push([[564],{925:(e,l,t)=>{t.d(l,{e7:()=>a,KS:()=>n,WU:()=>o,Fv:()=>u});const a=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],n=(e,l)=>{const t=new Date(e,l,0).getDate(),a=new Date(e,l-1,1),n=[];for(let o=6-a.getDay(),u=1;o<t;o+=7,u++)n.push({day:o+1,label:`Sábado ${o+1}`,week:u,total:0});return n},o=e=>{if(!e)return null;const l=new Date(e);return[l.getUTCDate(),l.getUTCMonth()+1,l.getUTCFullYear()].join("/")},u=e=>e?[e.split("/")[2],e.split("/")[1],e.split("/")[0]].join("-"):null},8468:(e,l,t)=>{t.d(l,{Z:()=>a,K:()=>n});const a={email:e=>{const l=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return l.test(String(e).toLowerCase())||!e||"El correo no es válido."},url:e=>/[-a-zA-Z0-9@:%_+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_+.~#?&//=]*)?/.test(e)||!e||"Introduzca una URL válida",date:e=>/^((0?[1-9]|[12][0-9]|3[01])[- /.](0?[1-9]|1[012])[- /.](19|20)?[0-9]{2})*$/.test(e)||!e||"Introduzca una fecha válida",password:e=>e.length>=6||!e||"Debe tener al menos 6 carácteres.",required:e=>!!e||"El campo es requerido.",phone:e=>{const l=/^[0-9]/;return l.test(String(e).toLowerCase())&&8===e.length||!e||"Introduzca un numero de celular válido."},alphabet:e=>{const l=/^[a-zñÑáéíóú]/;return l.test(String(e).toLowerCase())||!e||"Solo se permiten letras."},number:e=>{const l=/^\d+$/g;return l.test(String(e))||!e||"Solo se permiten numeros enteros."},decimal:e=>{const l=/^\d*\.?\d*$/g;return l.test(String(e))||!e||"Use el punto (.) para los decimales."}};function n(e){return/^\d*\.?\d*$/.test(e)}},564:(e,l,t)=>{t.r(l),t.d(l,{default:()=>me});var a=t(3673),n=t(2323),o=t(1959),u=t(9582),s=t(2993),i=t(185),d=t(925),r=t(9236),c=t(8468),p=function(e,l,t,a){function n(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,o){function u(e){try{i(a.next(e))}catch(l){o(l)}}function s(e){try{i(a["throw"](e))}catch(l){o(l)}}function i(e){e.done?t(e.value):n(e.value).then(u,s)}i((a=a.apply(e,l||[])).next())}))};const m={key:0,class:"container"},v={class:"treasury-title"},y={key:0,class:"text-warning"},w={class:"subtitle"},_={class:"row"},f={key:0,class:"col-xs-12 col-sm-5"},b={class:"col-xs-12"},h={class:"col-xs-12"},g={class:"col-xs-12"},k={class:"row items-center justify-end"},x={class:"col-xs-12"},D=(0,a._)("h3",{class:"text-secondary treasury-subtitle q-px-md"},"Datos de la factura, recibo...",-1),q={class:"col-xs-12"},C={class:"col-xs-12"},S={class:"col-xs-12"},U={class:"col-xs-12"},V={class:"q-table-simple q-table__container q-table--horizontal-separator column no-wrap q-table--dense q-table--no-wrap"},z={key:0,class:"text-left"},O=(0,a._)("th",{class:"text-left"},[(0,a._)("strong",null,"Descripción")],-1),T={key:1,class:"text-left"},E=(0,a._)("strong",null,"Datos de facturación",-1),L=[E],W=(0,a._)("th",{class:"text-right"},[(0,a._)("strong",null,"Valor")],-1),$={key:0,class:"width-80"},A={class:"text-left"},Z={class:"treasury-departament"},I={key:1,class:"text-left"},R={class:"treasury-list-concepts"},F={key:0},Q=(0,a._)("strong",null,"Tipo de documento:",-1),H={key:1},N=(0,a._)("strong",null,"Número de documento:",-1),P={key:2},j=(0,a._)("strong",null,"Proveedor:",-1),B={class:"text-right total"},G=(0,a._)("th",{class:"text-left",colspan:"2"},[(0,a._)("strong",null,"Total")],-1),K={class:"text-right"},M={class:"text-right q-pt-xs q-gutter-xs"},Y=(0,a.aZ)({setup(e){var l,t;const E=(0,r.useStore)(),Y=[{value:"FACTURA",label:"FACTURA"},{value:"RECIBO",label:"RECIBO"},{value:"NOTA DE VENTA",label:"NOTA DE VENTA"},{value:"OTRO",label:"OTRO"}],J=null===(t=null===(l=E.state.user)||void 0===l?void 0:l.user)||void 0===t?void 0:t.company.id,X=(0,o.iH)([]),ee=(0,o.iH)([]),le=(0,o.iH)([]),te=(0,o.iH)(!0),ae=(0,o.iH)({id:null,date:null,value:"",concept:"",documentType:"",document_number:"",supplier:"",expense:null,department:null,idDepartment:null}),ne=(0,o.iH)(),oe=(0,o.iH)(),ue=(0,o.iH)([]),se=(0,u.yj)(),{expenseId:ie}=se.params,de=()=>p(this,void 0,void 0,(function*(){ne.value=yield s.http.get("expenses/"+ +ie)})),re=()=>p(this,void 0,void 0,(function*(){const e=yield s.http.get("departments?order=id&type=LOCAL");return e.rows.map((e=>{var l;return{value:e.id,type:"GLOBAL"===e.type?"Asociación":"Iglesia local",label:e.name,group:e.group,total:(null===(l=ee.value.find((l=>l.department.id===e.id)))||void 0===l?void 0:l.total)||0}}))})),ce=()=>p(this,void 0,void 0,(function*(){const e=yield s.http.get(`flows?id_company=${J}&type=GENERAL`);ee.value=e.rows})),pe=(e,l)=>{l((()=>{if(""===e)le.value=X.value;else{const l=e.toLowerCase();le.value=X.value.filter((e=>e.label.toLowerCase().indexOf(l)>-1))}}))},me=()=>p(this,void 0,void 0,(function*(){ae.value.id_expense=ne.value.id,ae.value.document_type=ae.value.documentType.value,ae.value.id_department=ae.value.idDepartment.value,ae.value.id?yield s.http.put(`expensesdetails/${ae.value.id}`,ae.value):yield s.http.post("expensesdetails",ae.value),yield _e(),yield we()})),ve=e=>p(this,void 0,void 0,(function*(){ae.value=yield s.http.get(`expensesdetails/${e}`),ae.value.idDepartment={value:ae.value.department.id,label:ae.value.department.name},ae.value.documentType={value:ae.value.document_type,label:ae.value.document_type}})),ye=e=>{(0,i.Confirm)("¿Desea eliminar el registro?",(()=>p(this,void 0,void 0,(function*(){yield s.http["delete"](`expensesdetails/${e}`),yield _e()}))))},we=()=>p(this,void 0,void 0,(function*(){te.value=!1,yield(0,a.Y3)((()=>{ae.value={id:null,date:null,value:"",concept:"",documentType:"",document_number:"",supplier:"",expense:null,department:null,idDepartment:null},te.value=!0}))})),_e=()=>p(this,void 0,void 0,(function*(){const e=yield s.http.get(`expensesdetails?id_expense=${ne.value.id}`);ue.value=e.rows})),fe=()=>p(this,void 0,void 0,(function*(){const e=yield s.http.get(`entries?year=${ne.value.year}&month=${ne.value.month}&id_company=${J}`);e.count&&(oe.value=e.rows[0])})),be=(0,o.Fl)((()=>{let e=0;for(const l of ue.value)e+=parseFloat(l.value);return e}));return(0,a.wF)((()=>p(this,void 0,void 0,(function*(){yield ce(),X.value=yield re(),yield de(),yield _e(),yield fe()})))),(e,l)=>{const t=(0,a.up)("q-btn"),u=(0,a.up)("q-item-label"),s=(0,a.up)("q-item-section"),i=(0,a.up)("q-item"),r=(0,a.up)("q-select"),p=(0,a.up)("q-input"),E=(0,a.up)("q-date"),J=(0,a.up)("q-popup-proxy"),X=(0,a.up)("q-icon"),ee=(0,a.up)("q-form"),se=(0,a.Q2)("close-popup");return ne.value?((0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("h2",v,[(0,a.Wm)(t,{icon:"arrow_back",round:"",flat:"",onClick:l[0]||(l[0]=l=>e.$router.push(`/treasury/entryexpense/${oe.value.id}/${e.$route.params.expenseId}`))}),(0,a.Uk)(" Gastos - "+(0,n.zw)((0,o.SU)(d.e7)[ne.value.month-1])+" ",1),"CLOSED"===ne.value.state?((0,a.wg)(),(0,a.iD)("span",y," CERRADO")):(0,a.kq)("",!0),(0,a._)("span",w,"Total: "+(0,n.zw)((0,o.SU)(be))+" Bs.",1)]),(0,a._)("div",_,["CLOSED"!==ne.value.state?((0,a.wg)(),(0,a.iD)("div",f,[te.value?((0,a.wg)(),(0,a.j4)(ee,{key:0,onSubmit:me,onReset:we,class:"q-gutter-md"},{default:(0,a.w5)((()=>[(0,a._)("div",b,[(0,a.Wm)(r,{filled:"",label:"Departamento",modelValue:ae.value.idDepartment,"onUpdate:modelValue":l[1]||(l[1]=e=>ae.value.idDepartment=e),"use-input":"","use-chips":"","input-debounce":"0",options:le.value,onFilter:pe,"lazy-rules":"",rules:[e=>!!e||"Seleccione el departamento"]},{option:(0,a.w5)((e=>[(0,a.Wm)(i,(0,n.vs)((0,a.F4)(e.itemProps)),{default:(0,a.w5)((()=>[(0,a.Wm)(s,{class:"treasury-department-item"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.opt.label),1)])),_:2},1024),(0,a.Wm)(u,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.opt.type),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","rules"])]),(0,a._)("div",h,[(0,a.Wm)(p,{filled:"",label:"Concepto",modelValue:ae.value.concept,"onUpdate:modelValue":l[2]||(l[2]=e=>ae.value.concept=e),rules:[e=>!!e||"Debe llenar el concepto"]},null,8,["modelValue","rules"])]),(0,a._)("div",g,[(0,a.Wm)(p,{label:"Fecha",filled:"",modelValue:ae.value.date,"onUpdate:modelValue":l[4]||(l[4]=e=>ae.value.date=e),mask:"date",rules:["date",e=>!!e||"Debe seleccionar una fecha"]},{append:(0,a.w5)((()=>[(0,a.Wm)(X,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(J,{ref:"qDateProxy",cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(E,{modelValue:ae.value.date,"onUpdate:modelValue":l[3]||(l[3]=e=>ae.value.date=e),minimal:""},{default:(0,a.w5)((()=>[(0,a._)("div",k,[(0,a.wy)((0,a.Wm)(t,{label:"Cerrar",color:"primary",flat:""},null,512),[[se]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"])]),(0,a._)("div",x,[(0,a.Wm)(p,{filled:"",label:"Valor",modelValue:ae.value.value,"onUpdate:modelValue":l[5]||(l[5]=e=>ae.value.value=e),rules:[(0,o.SU)(c.Z).required,(0,o.SU)(c.Z).decimal]},null,8,["modelValue","rules"])]),D,(0,a._)("div",q,[(0,a.Wm)(r,{filled:"",label:"Tipo de documento",modelValue:ae.value.documentType,"onUpdate:modelValue":l[6]||(l[6]=e=>ae.value.documentType=e),options:Y},null,8,["modelValue"])]),(0,a._)("div",C,[(0,a.Wm)(p,{filled:"",label:"Número de documento",modelValue:ae.value.document_number,"onUpdate:modelValue":l[7]||(l[7]=e=>ae.value.document_number=e)},null,8,["modelValue"])]),(0,a._)("div",S,[(0,a.Wm)(p,{filled:"",label:"Proveedor",modelValue:ae.value.supplier,"onUpdate:modelValue":l[8]||(l[8]=e=>ae.value.supplier=e)},null,8,["modelValue"])]),(0,a._)("div",U,[ae.value.id?((0,a.wg)(),(0,a.j4)(t,{key:0,type:"reset",padding:"10px",label:"Cancelar","no-caps":"",icon:"cancel",class:"full-width q-mb-sm"})):(0,a.kq)("",!0),(0,a.Wm)(t,{type:"submit",padding:"10px",label:ae.value.id?"Actualizar":"Registrar",color:"primary","no-caps":"",icon:"check",class:"full-width"},null,8,["label"])])])),_:1})):(0,a.kq)("",!0)])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,n.C_)(["col-xs-12 tithe-column",{"col-sm-7":"CLOSED"!==ne.value.state,"col-sm-12":"CLOSED"===ne.value.state}])},[(0,a._)("div",V,[(0,a._)("table",{class:(0,n.C_)(["q-table",{"treasury-table-data":"CLOSED"===ne.value.state}])},[(0,a._)("thead",null,[(0,a._)("tr",null,["CLOSED"!==ne.value.state?((0,a.wg)(),(0,a.iD)("th",z)):(0,a.kq)("",!0),O,"CLOSED"===ne.value.state?((0,a.wg)(),(0,a.iD)("th",T,L)):(0,a.kq)("",!0),W])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(ue.value,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},["CLOSED"!==ne.value.state?((0,a.wg)(),(0,a.iD)("td",$,[(0,a.Wm)(t,{size:"sm",icon:"edit",round:"",flat:"",onClick:l=>ve(e.id)},null,8,["onClick"]),(0,a.Wm)(t,{size:"sm",icon:"delete",round:"",flat:"",onClick:l=>ye(e.id)},null,8,["onClick"])])):(0,a.kq)("",!0),(0,a._)("td",A,[(0,a.Uk)((0,n.zw)(e.concept)+" ",1),(0,a._)("strong",Z,(0,n.zw)(e.department.name),1),(0,a._)("em",null,"Registrado el "+(0,n.zw)((0,o.SU)(d.WU)(e.date)),1)]),"CLOSED"===ne.value.state?((0,a.wg)(),(0,a.iD)("td",I,[(0,a._)("ul",R,[e.document_type?((0,a.wg)(),(0,a.iD)("li",F,[Q,(0,a.Uk)(" "+(0,n.zw)(e.document_type),1)])):(0,a.kq)("",!0),e.document_number?((0,a.wg)(),(0,a.iD)("li",H,[N,(0,a.Uk)(" "+(0,n.zw)(e.document_number),1)])):(0,a.kq)("",!0),e.supplier?((0,a.wg)(),(0,a.iD)("li",P,[j,(0,a.Uk)(" "+(0,n.zw)(e.supplier),1)])):(0,a.kq)("",!0)])])):(0,a.kq)("",!0),(0,a._)("td",B,(0,n.zw)(e.value),1)])))),128))]),(0,a._)("tfoot",null,[(0,a._)("tr",null,[G,(0,a._)("th",K,[(0,a._)("strong",null,(0,n.zw)((0,o.SU)(be)),1)])])])],2)]),(0,a._)("div",M,[oe.value?((0,a.wg)(),(0,a.j4)(t,{key:0,label:"Ver ingresos del mes","no-caps":"",icon:"attach_money",padding:"10px 20px",class:"btn-close-month",onClick:l[9]||(l[9]=l=>e.$router.push(`/treasury/week/${oe.value.id}`))})):(0,a.kq)("",!0)])],2)])])):(0,a.kq)("",!0)}}});var J=t(8240),X=t(5269),ee=t(2448),le=t(3414),te=t(2035),ae=t(2350),ne=t(4689),oe=t(4554),ue=t(3944),se=t(6915),ie=t(6429),de=t(677),re=t(7518),ce=t.n(re);const pe=Y,me=pe;ce()(Y,"components",{QBtn:J.Z,QForm:X.Z,QSelect:ee.Z,QItem:le.Z,QItemSection:te.Z,QItemLabel:ae.Z,QInput:ne.Z,QIcon:oe.Z,QPopupProxy:ue.Z,QDate:se.Z,QTable:ie.Z}),ce()(Y,"directives",{ClosePopup:de.Z})}}]);