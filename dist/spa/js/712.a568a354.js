"use strict";(globalThis["webpackChunksmi_frontend"]=globalThis["webpackChunksmi_frontend"]||[]).push([[712],{3712:(e,l,o)=>{o.r(l),o.d(l,{default:()=>I});var n=o(3673),t=o(2323),a=o(1959),i=o(8880),s=o(8339),u=o(2993),r=o(925),c=o(9236),v=function(e,l,o,n){function t(e){return e instanceof o?e:new o((function(l){l(e)}))}return new(o||(o=Promise))((function(o,a){function i(e){try{u(n.next(e))}catch(l){a(l)}}function s(e){try{u(n["throw"](e))}catch(l){a(l)}}function u(e){e.done?o(e.value):t(e.value).then(i,s)}u((n=n.apply(e,l||[])).next())}))};const d={class:"container"},p={class:"treasury-title"},m={class:"q-pb-md row q-col-gutter-sm"},h={class:"col-xs-12 col-sm-4"},y={class:"col-xs-12 col-sm-5"},b={class:"col-xs-12 col-sm-3"},w={class:"q-table-simple q-table__container q-table--horizontal-separator column no-wrap q-table--dense q-table--no-wrap table-responsive"},f={class:"q-table treasury-table-data"},g=(0,n._)("th",null,"Nombre completo",-1),_={key:0,class:"treasury-observation"},k={class:"flow-row-table"},S={class:"text-hidden"},q={key:0,class:"flow-row-content text-right"},D={class:"treasury-list-concepts"},C={class:"treasury-observation-report"},U={key:0,class:"treasury-list-concepts"},V={class:"treasury-observation-report"},z=["onClick"],H={key:1,class:"treasury-observation text-right"},$=(0,n.aZ)({__name:"Offerings",setup(e){var l,o,$;const x=(0,c.o)(),E=(0,s.tv)(),Y=(0,a.iH)(),M=(0,a.iH)(""),T=(0,a.iH)(!1),Z=(0,a.iH)((new Date).getFullYear()),N=Number(null===($=null===(o=null===(l=x.state.user)||void 0===l?void 0:l.user)||void 0===o?void 0:o.company)||void 0===$?void 0:$.id),O=(0,r.V4)(),Q=()=>E.push("/treasury/reports"),I={member:"Miembro",sympathizer:"Miembro Esc. sabática",visit:"Visita"},K=(e,l)=>v(this,void 0,void 0,(function*(){let o="users?order=fullname";o+=e?l?`&fullname=${e}&all_association=true`:`&fullname=${e}&all_churchs=true`:`&id_company=${N}`;const n=yield u.http.get(o,!1),t={};return n.rows.forEach((e=>{var o,n,a,i;t[`user-${e.id||""}`]={value:String(e.id),label:String(null===(o=e.person)||void 0===o?void 0:o.fullname),church:String(null===(n=e.company)||void 0===n?void 0:n.name),association:l?String(null===(a=e.association)||void 0===a?void 0:a.name):void 0,type:null===(i=e.type)||void 0===i?void 0:i.toLowerCase(),months:{}}})),t}));(0,n.YP)(Z,(()=>v(this,void 0,void 0,(function*(){yield B()}))));const W=(0,n.Fl)((()=>{var e,l;if(""!==M.value){const l={};for(const o in Y.value)Y.value[o].label.toLowerCase().includes(M.value.toLowerCase())&&(!T.value||T.value&&"MEMBER"===(null===(e=Y.value[o].type)||void 0===e?void 0:e.toUpperCase()))&&(l[o]=Y.value[o]);return l}if(T.value){const e={};for(const o in Y.value)"MEMBER"===(null===(l=Y.value[o].type)||void 0===l?void 0:l.toUpperCase())&&(e[o]=Y.value[o]);return e}return Y.value})),B=()=>v(this,void 0,void 0,(function*(){var e,l,o,n,t,a,i,s,r,c,v,d;for(const u in Y.value)Y.value[u].months={};const p=yield u.http.get(`entriesdetails?year=${Z.value}&id_department=0&id_company=${N}&order=entry_detail.id`);for(const u of p.rows)(null===(e=u.user)||void 0===e?void 0:e.id)&&Y.value&&Y.value[`user-${null===(l=u.user)||void 0===l?void 0:l.id}`]?L(Y.value[`user-${null===(o=u.user)||void 0===o?void 0:o.id}`],u):Y.value&&(Y.value[`user-${(null===(n=u.user)||void 0===n?void 0:n.id)||""}`]={value:String(null===(t=u.user)||void 0===t?void 0:t.id),label:String(null===(i=null===(a=u.user)||void 0===a?void 0:a.person)||void 0===i?void 0:i.fullname),church:String(null===(r=null===(s=u.user)||void 0===s?void 0:s.company)||void 0===r?void 0:r.name),association:void 0,type:null===(v=null===(c=u.user)||void 0===c?void 0:c.type)||void 0===v?void 0:v.toLowerCase(),months:{}},L(Y.value[`user-${(null===(d=u.user)||void 0===d?void 0:d.id)||""}`],u))})),L=(e,l)=>{if(e.months){e.months[l.entry.month]||(e.months[l.entry.month]={});for(const o of l.concepts)o.concept.value&&(e.months[l.entry.month][o.concept.value]?e.months[l.entry.month][o.concept.value].value+=Number(o.value):e.months[l.entry.month][o.concept.value]={id:String(o.concept.value),type:o.concept.type,label:o.concept.label,group:o.concept.group,value:Number(o.value)})}},P=e=>{const l=[];for(const o in e)e[o].group&&["TITHES","SCOOP"].includes(e[o].group)&&l.push(e[o]);return l};return(0,n.bv)((()=>v(this,void 0,void 0,(function*(){Y.value=yield K(""),yield B()})))),(e,l)=>{var o;const s=(0,n.up)("q-btn"),u=(0,n.up)("q-select"),c=(0,n.up)("q-icon"),v=(0,n.up)("q-input"),$=(0,n.up)("q-checkbox");return(0,n.wg)(),(0,n.iD)("div",d,[(0,n._)("h2",p,[(0,n.Wm)(s,{icon:"arrow_back",round:"",flat:"",onClick:Q}),(0,n.Uk)(" Informe de ofrendas por persona - "+(0,t.zw)(null===(o=(0,a.SU)(x).state.user.user.company)||void 0===o?void 0:o.name),1)]),(0,n._)("div",m,[(0,n._)("div",h,[(0,n.Wm)(u,{filled:"",modelValue:Z.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Z.value=e),options:(0,a.SU)(O),label:"Gestión"},null,8,["modelValue","options"])]),(0,n._)("div",y,[(0,n.Wm)(v,{filled:"",label:"Buscar por Nombre o apellido",modelValue:M.value,"onUpdate:modelValue":l[2]||(l[2]=e=>M.value=e),"input-debounce":"1000",placeholder:"Escribe el nombre o apellido de la persona a buscar"},(0,n.Nv)({_:2},[M.value.length>0?{name:"append",fn:(0,n.w5)((()=>[(0,n.Wm)(c,{name:"close",onClick:l[1]||(l[1]=e=>M.value=""),class:"cursor-pointer"})])),key:"0"}:void 0]),1032,["modelValue"])]),(0,n._)("div",b,[(0,n.Wm)($,{modelValue:T.value,"onUpdate:modelValue":l[3]||(l[3]=e=>T.value=e),label:"Ver solo miembros"},null,8,["modelValue"])])]),(0,n._)("div",w,[(0,n._)("table",f,[(0,n._)("thead",null,[(0,n._)("tr",null,[g,((0,n.wg)(),(0,n.iD)(n.HY,null,(0,n.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(e=>(0,n._)("th",{key:e},(0,t.zw)((0,a.SU)(r.e7)[e-1]),1))),64))])]),(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,a.SU)(W),(l=>{var o;return(0,n.wg)(),(0,n.iD)("tr",{key:l.value},[(0,n._)("td",null,[(0,n.Uk)((0,t.zw)(l.label)+" ",1),l.type?((0,n.wg)(),(0,n.iD)("span",_,(0,t.zw)(I[l.type])+" "+(0,t.zw)((null===(o=e.$store.state.user.user.company)||void 0===o?void 0:o.name)!==l.church?`- ${l.church}`:""),1)):(0,n.kq)("",!0)]),((0,n.wg)(),(0,n.iD)(n.HY,null,(0,n.Ko)([1,2,3,4,5,6,7,8,9,10,11,12],(e=>(0,n._)("td",{key:e},[(0,n._)("div",k,[(0,n._)("span",S,(0,t.zw)((0,a.SU)(r.e7)[e-1])+":",1),l.months&&l.months[e]?((0,n.wg)(),(0,n.iD)("div",q,[(0,n._)("ul",D,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(P(l.months[e]),(e=>((0,n.wg)(),(0,n.iD)("li",{key:e.id},[(0,n._)("span",C,(0,t.zw)(e.label)+": ",1),(0,n.Uk)(),(0,n._)("strong",null,(0,t.zw)(e.value),1)])))),128))]),!0===l.active?((0,n.wg)(),(0,n.iD)("ul",U,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.months[e],(e=>((0,n.wg)(),(0,n.iD)("li",{key:e.id},["TITHES"!==e.group&&"SCOOP"!==e.group?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("span",V,(0,t.zw)(e.label)+": ",1),(0,n.Uk)(),(0,n._)("strong",null,(0,t.zw)(e.value),1)],64)):(0,n.kq)("",!0)])))),128))])):(0,n.kq)("",!0),Object.keys(l.months[e]).length>P(l.months[e]).length?((0,n.wg)(),(0,n.iD)("a",{key:1,class:"flow-row-link",href:"",onClick:(0,i.iM)((e=>l.active=!l.active),["prevent"])},(0,t.zw)(!0===l.active?"Ver menos":"Ver más"),9,z)):(0,n.kq)("",!0)])):((0,n.wg)(),(0,n.iD)("span",H,"-"))])]))),64))])})),128))])])])])}}});var x=o(2165),E=o(2448),Y=o(4689),M=o(4554),T=o(5735),Z=o(6429),N=o(7518),O=o.n(N);const Q=$,I=Q;O()($,"components",{QBtn:x.Z,QSelect:E.Z,QInput:Y.Z,QIcon:M.Z,QCheckbox:T.Z,QTable:Z.Z})}}]);